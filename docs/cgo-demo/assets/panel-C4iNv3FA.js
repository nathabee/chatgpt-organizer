function ts(){function e(Le,es){if(!Le)throw new Error(`[dom] Missing #${es}`);return Le}const t=e(document.getElementById("scopeLabel"),"scopeLabel"),o=e(document.getElementById("btnScopeChange"),"btnScopeChange"),n=e(document.getElementById("btnScopeRefresh"),"btnScopeRefresh"),s=e(document.getElementById("scopeDialog"),"scopeDialog"),r=e(document.getElementById("scopeDate"),"scopeDate"),c=e(document.getElementById("btnScopeCancel"),"btnScopeCancel"),a=e(document.getElementById("btnScopeApply"),"btnScopeApply"),u=e(document.getElementById("scopeLoadedSingles"),"scopeLoadedSingles"),P=e(document.getElementById("scopeLoadedProjects"),"scopeLoadedProjects"),l=e(document.getElementById("scopeLoadedProjectChats"),"scopeLoadedProjectChats"),h=e(document.querySelector(".scopeLoading"),"scopeLoading"),i=document.getElementById("tabSingle"),f=document.getElementById("tabProjects"),g=document.getElementById("viewSingle"),y=document.getElementById("viewProjects"),b=document.getElementById("tabOrganize"),E=document.getElementById("tabSearch"),C=document.getElementById("tabLogs"),p=document.getElementById("tabStats"),S=document.getElementById("viewOrganize"),d=document.getElementById("viewSearch"),j=document.getElementById("viewLogs"),v=document.getElementById("viewStats"),w=e(document.getElementById("searchQuery"),"searchQuery"),T=e(document.getElementById("btnSearchClear"),"btnSearchClear"),L=e(document.getElementById("btnSearchResetFilters"),"btnSearchResetFilters"),m=e(document.getElementById("searchScope"),"searchScope"),x=e(document.getElementById("searchArchived"),"searchArchived"),O=e(document.getElementById("searchUpdatedWithin"),"searchUpdatedWithin"),$=e(document.getElementById("searchCreatedWithin"),"searchCreatedWithin"),I=e(document.getElementById("searchUpdatedAfter"),"searchUpdatedAfter"),z=e(document.getElementById("searchUpdatedBefore"),"searchUpdatedBefore"),D=e(document.getElementById("searchCreatedAfter"),"searchCreatedAfter"),k=e(document.getElementById("searchCreatedBefore"),"searchCreatedBefore"),_=e(document.getElementById("searchInfoBox"),"searchInfoBox"),H=e(document.getElementById("btnSearchListSingle"),"btnSearchListSingle"),G=e(document.getElementById("btnSearchListProjects"),"btnSearchListProjects"),U=e(document.getElementById("searchLoadedSingles"),"searchLoadedSingles"),R=e(document.getElementById("searchLoadedProjects"),"searchLoadedProjects"),F=e(document.getElementById("searchLoadedProjectChats"),"searchLoadedProjectChats"),J=e(document.getElementById("searchInfoLimits"),"searchInfoLimits"),te=e(document.getElementById("searchStatus"),"searchStatus"),ne=e(document.getElementById("searchResultsCount"),"searchResultsCount"),Qe=e(document.getElementById("searchResults"),"searchResults"),et=document.getElementById("singleLimit"),tt=document.getElementById("btnListSingle"),nt=document.getElementById("singleStatus"),st=document.getElementById("cbSingleToggleAll"),ot=document.getElementById("btnSingleDelete"),it=document.getElementById("singleExecOut"),ct=document.getElementById("singleExecProgressWrap"),rt=document.getElementById("singleExecProgress"),at=document.getElementById("singleExecProgressText"),lt=document.getElementById("singleConfirmBox"),dt=document.getElementById("singleConfirmTitle"),ut=document.getElementById("singleConfirmPreview"),gt=document.getElementById("singleCbConfirm"),ft=document.getElementById("singleBtnConfirmExecute"),pt=document.getElementById("singleBtnCancelExecute"),ht=document.getElementById("singleCount"),mt=document.getElementById("singleSelectedCount"),Et=document.getElementById("singleList"),Ct=document.getElementById("projectsLimit"),St=document.getElementById("projectsChatsLimit"),bt=document.getElementById("btnListProjects"),yt=document.getElementById("projectsStatus"),It=document.getElementById("btnProjectsDelete"),jt=document.getElementById("projectsExecOut"),vt=document.getElementById("projectsChatsExecProgressWrap"),Pt=document.getElementById("projectsChatsExecProgress"),xt=document.getElementById("projectsChatsExecProgressText"),Tt=document.getElementById("projectsProjectsExecProgressWrap"),zt=document.getElementById("projectsProjectsExecProgress"),Lt=document.getElementById("projectsProjectsExecProgressText"),wt=document.getElementById("projectsConfirmBox"),Ot=document.getElementById("projectsConfirmTitle"),kt=document.getElementById("projectsConfirmPreview"),Bt=document.getElementById("projectsCbConfirm"),Dt=document.getElementById("projectsBtnConfirmExecute"),At=document.getElementById("projectsBtnCancelExecute"),_t=document.getElementById("projectsCount"),$t=document.getElementById("projectsChatsCount"),Rt=document.getElementById("projectsSelectedChatsCount"),Mt=document.getElementById("projectsSelectedProjectsCount"),Nt=document.getElementById("projectsList"),Ut=e(document.getElementById("mountCreateProjectProjects"),"mountCreateProjectProjects"),Ht=e(document.getElementById("mountCreateProjectOrganize"),"mountCreateProjectOrganize"),Gt=document.getElementById("logsLimit"),Ft=document.getElementById("btnLogsRefresh"),Jt=document.getElementById("logsStatus"),Wt=document.getElementById("logsTrimKeep"),Vt=document.getElementById("btnLogsTrim"),Xt=document.getElementById("btnLogsExport"),Kt=document.getElementById("btnLogsClear"),Yt=document.getElementById("logsOut"),qt=document.getElementById("cfgTraceScope"),Zt=document.getElementById("cfgStopAfterOutOfScope"),Qt=document.getElementById("btnCfgResetDefaults"),en=document.getElementById("cfgStatus"),tn=document.getElementById("logsCbDebug"),nn=document.getElementById("debugLimit"),sn=document.getElementById("btnDebugRefresh"),on=document.getElementById("btnDebugExport"),cn=document.getElementById("btnDebugClear"),rn=document.getElementById("debugStatus"),an=document.getElementById("debugOut"),ln=e(document.getElementById("btnStatsRecalc"),"btnStatsRecalc"),dn=e(document.getElementById("statsStatus"),"statsStatus"),un=e(document.getElementById("statsLastCacheUpdate"),"statsLastCacheUpdate"),gn=e(document.getElementById("statsSnapshotBox"),"statsSnapshotBox"),fn=e(document.getElementById("statsSingleChats"),"statsSingleChats"),pn=e(document.getElementById("statsProjects"),"statsProjects"),hn=e(document.getElementById("statsProjectChats"),"statsProjectChats"),mn=e(document.getElementById("statsTotalChats"),"statsTotalChats"),En=e(document.getElementById("statsArchivedChats"),"statsArchivedChats"),Cn=e(document.getElementById("statsAvgChatsPerProject"),"statsAvgChatsPerProject"),Sn=e(document.getElementById("statsLimitsHint"),"statsLimitsHint"),bn=e(document.getElementById("statsActivityBox"),"statsActivityBox"),yn=e(document.getElementById("statsActivityExplain"),"statsActivityExplain"),In=e(document.getElementById("statsCreatedHeatmap"),"statsCreatedHeatmap"),jn=e(document.getElementById("statsLifetimeHist"),"statsLifetimeHist"),vn=e(document.getElementById("statsProjectsBox"),"statsProjectsBox"),Pn=e(document.getElementById("statsProjectSizeHist"),"statsProjectSizeHist"),xn=e(document.getElementById("statsTopProjects"),"statsTopProjects"),Tn=e(document.getElementById("statsDeletesBox"),"statsDeletesBox"),zn=e(document.getElementById("statsDeletedChats"),"statsDeletedChats"),Ln=e(document.getElementById("statsDeletedProjects"),"statsDeletedProjects"),wn=e(document.getElementById("organizeSource"),"organizeSource"),On=e(document.getElementById("organizeFilter"),"organizeFilter"),kn=e(document.getElementById("cbOrganizeToggleAll"),"cbOrganizeToggleAll"),Bn=e(document.getElementById("organizeSourceStatus"),"organizeSourceStatus"),Dn=e(document.getElementById("organizeSourceCount"),"organizeSourceCount"),An=e(document.getElementById("organizeSelectedCount"),"organizeSelectedCount"),_n=e(document.getElementById("organizeSourceList"),"organizeSourceList"),$n=e(document.getElementById("organizeProjectFilter"),"organizeProjectFilter"),Rn=e(document.getElementById("btnOrganizeClearTarget"),"btnOrganizeClearTarget"),Mn=e(document.getElementById("organizeProjectsStatus"),"organizeProjectsStatus"),Nn=e(document.getElementById("organizeProjectsCount"),"organizeProjectsCount"),Un=e(document.getElementById("organizeTargetLabel"),"organizeTargetLabel"),Hn=e(document.getElementById("organizeProjectList"),"organizeProjectList"),Gn=e(document.getElementById("btnOrganizeMove"),"btnOrganizeMove"),Fn=e(document.getElementById("organizeExecOut"),"organizeExecOut"),Jn=e(document.getElementById("organizeExecProgressWrap"),"organizeExecProgressWrap"),Wn=e(document.getElementById("organizeExecProgress"),"organizeExecProgress"),Vn=e(document.getElementById("organizeExecProgressText"),"organizeExecProgressText"),Xn=e(document.getElementById("organizeConfirmBox"),"organizeConfirmBox"),Kn=e(document.getElementById("organizeConfirmTitle"),"organizeConfirmTitle"),Yn=e(document.getElementById("organizeConfirmPreview"),"organizeConfirmPreview"),qn=e(document.getElementById("organizeCbConfirm"),"organizeCbConfirm"),Zn=e(document.getElementById("organizeBtnConfirmExecute"),"organizeBtnConfirmExecute"),Qn=e(document.getElementById("organizeBtnCancelExecute"),"organizeBtnCancelExecute");return{tabSingle:i,tabProjects:f,viewSingle:g,viewProjects:y,tabOrganize:b,tabSearch:E,tabLogs:C,tabStats:p,viewOrganize:S,viewSearch:d,viewLogs:j,viewStats:v,scopeLabelEl:t,btnScopeChange:o,btnScopeRefresh:n,scopeDialogEl:s,scopeDateEl:r,btnScopeCancel:c,btnScopeApply:a,scopeLoadedSinglesEl:u,scopeLoadedProjectsEl:P,scopeLoadedProjectChatsEl:l,scopeLoadingEl:h,searchInfoBoxEl:_,btnSearchListSingle:H,btnSearchListProjects:G,searchLoadedSinglesEl:U,searchLoadedProjectsEl:R,searchLoadedProjectChatsEl:F,searchInfoLimitsEl:J,btnSearchResetFilters:L,searchStatusEl:te,searchQueryEl:w,btnSearchClear:T,searchScopeEl:m,searchArchivedEl:x,searchUpdatedWithinEl:O,searchUpdatedAfterEl:I,searchUpdatedBeforeEl:z,searchCreatedWithinEl:$,searchCreatedAfterEl:D,searchCreatedBeforeEl:k,searchResultsCountEl:ne,searchResultsEl:Qe,singleLimitEl:et,btnListSingle:tt,singleStatusEl:nt,cbSingleToggleAll:st,btnSingleDelete:ot,singleExecOutEl:it,singleExecProgressWrapEl:ct,singleExecProgressEl:rt,singleExecProgressTextEl:at,singleConfirmBoxEl:lt,singleConfirmTitleEl:dt,singleConfirmPreviewEl:ut,singleCbConfirmEl:gt,singleBtnConfirmExecute:ft,singleBtnCancelExecute:pt,singleCountEl:ht,singleSelectedCountEl:mt,singleListEl:Et,projectsLimitEl:Ct,projectsChatsLimitEl:St,btnListProjects:bt,projectsStatusEl:yt,btnProjectsDelete:It,projectsExecOutEl:jt,projectsChatsExecProgressWrapEl:vt,projectsChatsExecProgressEl:Pt,projectsChatsExecProgressTextEl:xt,projectsProjectsExecProgressWrapEl:Tt,projectsProjectsExecProgressEl:zt,projectsProjectsExecProgressTextEl:Lt,projectsConfirmBoxEl:wt,projectsConfirmTitleEl:Ot,projectsConfirmPreviewEl:kt,projectsCbConfirmEl:Bt,projectsBtnConfirmExecute:Dt,projectsBtnCancelExecute:At,projectsCountEl:_t,projectsChatsCountEl:$t,projectsSelectedChatsCountEl:Rt,projectsSelectedProjectsCountEl:Mt,projectsListEl:Nt,mountCreateProjectProjectsEl:Ut,mountCreateProjectOrganizeEl:Ht,cfgTraceScopeEl:qt,cfgStopAfterOutOfScopeEl:Zt,btnCfgResetDefaults:Qt,cfgStatusEl:en,logsLimitEl:Gt,btnLogsRefresh:Ft,logsStatusEl:Jt,logsTrimKeepEl:Wt,btnLogsTrim:Vt,btnLogsExport:Xt,btnLogsClear:Kt,logsOutEl:Yt,logsCbDebugEl:tn,debugLimitEl:nn,btnDebugRefresh:sn,btnDebugExport:on,btnDebugClear:cn,debugStatusEl:rn,debugOutEl:an,btnStatsRecalc:ln,statsStatusEl:dn,statsLastCacheUpdateEl:un,statsSnapshotBoxEl:gn,statsSingleChatsEl:fn,statsProjectsEl:pn,statsProjectChatsEl:hn,statsTotalChatsEl:mn,statsArchivedChatsEl:En,statsAvgChatsPerProjectEl:Cn,statsLimitsHintEl:Sn,statsActivityBoxEl:bn,statsActivityExplainEl:yn,statsCreatedHeatmapEl:In,statsLifetimeHistEl:jn,statsProjectsBoxEl:vn,statsProjectSizeHistEl:Pn,statsTopProjectsEl:xn,statsDeletesBoxEl:Tn,statsDeletedChatsEl:zn,statsDeletedProjectsEl:Ln,organizeSourceEl:wn,organizeFilterEl:On,cbOrganizeToggleAll:kn,organizeSourceStatusEl:Bn,organizeSourceCountEl:Dn,organizeSelectedCountEl:An,organizeSourceListEl:_n,organizeProjectFilterEl:$n,btnOrganizeClearTarget:Rn,organizeProjectsStatusEl:Mn,organizeProjectsCountEl:Nn,organizeTargetLabelEl:Un,organizeProjectListEl:Hn,btnOrganizeMove:Gn,organizeExecOutEl:Fn,organizeExecProgressWrapEl:Jn,organizeExecProgressEl:Wn,organizeExecProgressTextEl:Vn,organizeConfirmBoxEl:Xn,organizeConfirmTitleEl:Kn,organizeConfirmPreviewEl:Yn,organizeCbConfirmEl:qn,organizeBtnConfirmExecute:Zn,organizeBtnCancelExecute:Qn}}const B={PING:"CGO_PING",PANEL_REFRESH_ALL:"CGO_PANEL_REFRESH_ALL",LIST_ALL_CHATS:"CGO_LIST_ALL_CHATS",LIST_ALL_CHATS_PROGRESS:"CGO_LIST_ALL_CHATS_PROGRESS",LIST_ALL_CHATS_DONE:"CGO_LIST_ALL_CHATS_DONE",LIST_GIZMO_PROJECTS:"CGO_LIST_GIZMO_PROJECTS",LIST_GIZMO_PROJECTS_PROGRESS:"CGO_LIST_GIZMO_PROJECTS_PROGRESS",LIST_GIZMO_PROJECTS_DONE:"CGO_LIST_GIZMO_PROJECTS_DONE",EXECUTE_DELETE:"CGO_EXECUTE_DELETE",EXECUTE_DELETE_PROGRESS:"CGO_EXECUTE_DELETE_PROGRESS",EXECUTE_DELETE_DONE:"CGO_EXECUTE_DELETE_DONE",DELETE_PROJECTS:"CGO_DELETE_PROJECTS",DELETE_PROJECTS_PROGRESS:"CGO_DELETE_PROJECTS_PROGRESS",DELETE_PROJECTS_DONE:"CGO_DELETE_PROJECTS_DONE",MOVE_CHATS_TO_PROJECT:"CGO_MOVE_CHATS_TO_PROJECT",MOVE_CHATS_TO_PROJECT_PROGRESS:"CGO_MOVE_CHATS_TO_PROJECT_PROGRESS",MOVE_CHATS_TO_PROJECT_DONE:"CGO_MOVE_CHATS_TO_PROJECT_DONE",CREATE_PROJECT:"CGO_CREATE_PROJECT",CREATE_PROJECT_PROGRESS:"CGO_CREATE_PROJECT_PROGRESS",CREATE_PROJECT_DONE:"CGO_CREATE_PROJECT_DONE"},se={projects:[{gizmoId:"g-wp",title:"WordPress Plugin Lab",href:"#",conversations:[{id:"c-wp-01",title:"Gutenberg block structure: block.json and edit/save",gizmoId:"g-wp"},{id:"c-wp-02",title:"Theme.json tokens: using WP preset colors properly",gizmoId:"g-wp"},{id:"c-wp-03",title:"Shortcodes vs blocks: when to use what",gizmoId:"g-wp"},{id:"c-wp-04",title:"WP REST API auth: nonce + cookies vs app passwords",gizmoId:"g-wp"},{id:"c-wp-05",title:"Plugin build pipeline: webpack vs Vite for blocks",gizmoId:"g-wp"},{id:"c-wp-06",title:"Internationalization: __(), _x(), and build steps",gizmoId:"g-wp"},{id:"c-wp-07",title:"Security checklist: sanitize, escape, capability checks",gizmoId:"g-wp"},{id:"c-wp-08",title:"FSE templates: managing patterns and template parts",gizmoId:"g-wp"},{id:"c-wp-09",title:"WP-CLI automation: exports, imports, and resets",gizmoId:"g-wp"},{id:"c-wp-10",title:"Performance: object cache, transients, and query reduction",gizmoId:"g-wp"}]},{gizmoId:"g-gh",title:"GitHub Workflow & Releases",href:"#",conversations:[{id:"c-gh-01",title:"Release assets: tagging strategy and upload via gh cli",gizmoId:"g-gh"},{id:"c-gh-02",title:"Changelog discipline: keep a version.md readable",gizmoId:"g-gh"},{id:"c-gh-03",title:"Repo hygiene: .gitignore, large files, and build artifacts",gizmoId:"g-gh"},{id:"c-gh-04",title:"Git add: '.' vs '-A' and deletion behavior",gizmoId:"g-gh"},{id:"c-gh-05",title:"PR workflow: branch naming and small reviewable commits",gizmoId:"g-gh"},{id:"c-gh-06",title:"CI basics: lint, typecheck, build, and release gates",gizmoId:"g-gh"}]},{gizmoId:"g-chrome-ext",title:"Chrome Extension Engineering",href:"#",conversations:[{id:"c-chx-01",title:"Manifest V3 overview: service worker + permissions",gizmoId:"g-chrome-ext"},{id:"c-chx-02",title:"Messaging patterns: panel ↔ background ↔ content",gizmoId:"g-chrome-ext"},{id:"c-chx-03",title:"Storage: chrome.storage.local vs session",gizmoId:"g-chrome-ext"},{id:"c-chx-04",title:"Rate limiting: throttling delete operations safely",gizmoId:"g-chrome-ext"},{id:"c-chx-05",title:"UI: side panel architecture and tab routing",gizmoId:"g-chrome-ext"},{id:"c-chx-06",title:"Testing: creating a demo mode with mocked seams",gizmoId:"g-chrome-ext"},{id:"c-chx-07",title:"Error handling: retry policies and progress events",gizmoId:"g-chrome-ext"},{id:"c-chx-08",title:"Packaging: dist layout and release zip scripts",gizmoId:"g-chrome-ext"}]},{gizmoId:"g-firefox-ext",title:"Firefox Extension Port (WebExtensions)",href:"#",conversations:[{id:"c-ffx-01",title:"Chrome vs Firefox APIs: browser.* polyfills and gaps",gizmoId:"g-firefox-ext"},{id:"c-ffx-02",title:"MV3 support status: what to avoid for portability",gizmoId:"g-firefox-ext"},{id:"c-ffx-03",title:"Side panel alternatives: UI constraints in Firefox",gizmoId:"g-firefox-ext"},{id:"c-ffx-04",title:"Packaging & signing: AMO upload checklist",gizmoId:"g-firefox-ext"}]},{gizmoId:"g-vite",title:"Vite Build System",href:"#",conversations:[{id:"c-vite-01",title:"Vite plugins: resolveId hooks and swapping seams",gizmoId:"g-vite"},{id:"c-vite-02",title:"Static asset emission: generateBundle and fileName paths",gizmoId:"g-vite"},{id:"c-vite-03",title:"Dev vs build parity: ensuring preview matches prod",gizmoId:"g-vite"},{id:"c-vite-04",title:"Aliasing strategies: regex alias vs plugin-based swapping",gizmoId:"g-vite"},{id:"c-vite-05",title:"TypeScript imports: allowImportingTsExtensions pitfalls",gizmoId:"g-vite"}]},{gizmoId:"g-node",title:"Node.js Backend Patterns",href:"#",conversations:[{id:"c-node-01",title:"HTTP server basics: Express vs Fastify tradeoffs",gizmoId:"g-node"},{id:"c-node-02",title:"Logging: structured logs and request correlation IDs",gizmoId:"g-node"},{id:"c-node-03",title:"Auth: session cookies vs JWT in practice",gizmoId:"g-node"},{id:"c-node-04",title:"Error boundaries: central error middleware strategy",gizmoId:"g-node"},{id:"c-node-05",title:"Rate limiting: burst control and backoff policies",gizmoId:"g-node"},{id:"c-node-06",title:"Deployment: process managers and health endpoints",gizmoId:"g-node"},{id:"c-node-07",title:"Security headers: CSP, HSTS, and X-Frame-Options",gizmoId:"g-node"},{id:"c-node-08",title:"Postgres patterns: migrations, pool sizing, retries",gizmoId:"g-node"},{id:"c-node-09",title:"Queues: background jobs and idempotency keys",gizmoId:"g-node"},{id:"c-node-10",title:"Monorepo setup: shared types and build pipelines",gizmoId:"g-node"},{id:"c-node-11",title:"Observability: metrics, tracing, dashboards",gizmoId:"g-node"}]},{gizmoId:"g-ts",title:"TypeScript Deep Dive",href:"#",conversations:[{id:"c-ts-01",title:"Discriminated unions for message buses",gizmoId:"g-ts"},{id:"c-ts-02",title:"Narrowing: type guards and exhaustive checks",gizmoId:"g-ts"},{id:"c-ts-03",title:"Strict mode: fixing implicit any and unknown",gizmoId:"g-ts"},{id:"c-ts-04",title:"API typing: request/response alignment and reuse",gizmoId:"g-ts"},{id:"c-ts-05",title:"Build targets: ESM, CJS, and browser bundles",gizmoId:"g-ts"},{id:"c-ts-06",title:"Module resolution: paths, aliases, and tooling",gizmoId:"g-ts"},{id:"c-ts-07",title:"Runtime validation: zod vs manual checks",gizmoId:"g-ts"},{id:"c-ts-08",title:"Error types: designing safe error objects",gizmoId:"g-ts"}]},{gizmoId:"g-ai",title:"AI Engineering Notes",href:"#",conversations:[{id:"c-ai-01",title:"Prompt design: constraints, examples, and failure modes",gizmoId:"g-ai"},{id:"c-ai-02",title:"RAG pipeline: chunking and retrieval tuning",gizmoId:"g-ai"},{id:"c-ai-03",title:"Evaluation: golden sets and regression tests",gizmoId:"g-ai"},{id:"c-ai-04",title:"Safety: what to log vs what not to log",gizmoId:"g-ai"},{id:"c-ai-05",title:"Latency: caching, streaming, and batching strategies",gizmoId:"g-ai"},{id:"c-ai-06",title:"Cost control: token budgets and request shaping",gizmoId:"g-ai"},{id:"c-ai-07",title:"Agent orchestration: tools, retries, and guardrails",gizmoId:"g-ai"},{id:"c-ai-08",title:"Model selection: quality vs speed tradeoffs",gizmoId:"g-ai"},{id:"c-ai-09",title:"Data privacy: redaction strategies and minimization",gizmoId:"g-ai"},{id:"c-ai-10",title:"Vector DB options: what matters in production",gizmoId:"g-ai"},{id:"c-ai-11",title:"Embedding drift: how to re-index safely",gizmoId:"g-ai"},{id:"c-ai-12",title:"Fine-tuning vs prompting: decision checklist",gizmoId:"g-ai"},{id:"c-ai-13",title:"Multi-language: tokenization surprises and UX",gizmoId:"g-ai"},{id:"c-ai-14",title:"Human-in-the-loop: review workflows that scale",gizmoId:"g-ai"},{id:"c-ai-15",title:"Incident playbook: model outages and fallback plans",gizmoId:"g-ai"}]},{gizmoId:"g-algo",title:"Algorithms & Data Structures",href:"#",conversations:[{id:"c-algo-01",title:"Big-O in real life: when it actually matters",gizmoId:"g-algo"},{id:"c-algo-02",title:"Graphs: BFS/DFS patterns and common mistakes",gizmoId:"g-algo"},{id:"c-algo-03",title:"Sorting: stable vs unstable and why you care",gizmoId:"g-algo"},{id:"c-algo-04",title:"Hashing: collisions, load factors, and performance",gizmoId:"g-algo"},{id:"c-algo-05",title:"Dynamic programming: memoization strategy guide",gizmoId:"g-algo"},{id:"c-algo-06",title:"Heaps: priority queues for scheduling tasks",gizmoId:"g-algo"},{id:"c-algo-07",title:"Bit tricks: fast masks and feature flags",gizmoId:"g-algo"},{id:"c-algo-08",title:"Strings: prefix functions, tries, and search",gizmoId:"g-algo"},{id:"c-algo-09",title:"Caching: LRU designs and edge cases",gizmoId:"g-algo"}]},{gizmoId:"g-sec",title:"Security & Hardening",href:"#",conversations:[{id:"c-sec-01",title:"CSP practical guide: reducing XSS risk",gizmoId:"g-sec"},{id:"c-sec-02",title:"CSRF: why it still bites modern apps",gizmoId:"g-sec"},{id:"c-sec-03",title:"Secrets management: env files vs vault",gizmoId:"g-sec"},{id:"c-sec-04",title:"Supply chain: npm audit realities and mitigation",gizmoId:"g-sec"},{id:"c-sec-05",title:"AuthZ: roles, scopes, and permission boundaries",gizmoId:"g-sec"},{id:"c-sec-06",title:"OWASP Top 10: the parts that actually show up",gizmoId:"g-sec"},{id:"c-sec-07",title:"Rate limiting & abuse: bots and scraping controls",gizmoId:"g-sec"},{id:"c-sec-08",title:"Server headers: hardening for modern browsers",gizmoId:"g-sec"},{id:"c-sec-09",title:"Cookie flags: SameSite, Secure, HttpOnly usage",gizmoId:"g-sec"},{id:"c-sec-10",title:"Dependency pinning: lockfiles and reproducibility",gizmoId:"g-sec"},{id:"c-sec-11",title:"TLS basics: certificates, renewals, and traps",gizmoId:"g-sec"},{id:"c-sec-12",title:"App isolation: containers and least privilege",gizmoId:"g-sec"},{id:"c-sec-13",title:"Logging sensitive data: redaction rules",gizmoId:"g-sec"}]},{gizmoId:"g-license",title:"Licenses & Compliance",href:"#",conversations:[{id:"c-lic-01",title:"MIT vs Apache-2.0: practical differences",gizmoId:"g-license"},{id:"c-lic-02",title:"GPL concerns: linking, distribution, and obligations",gizmoId:"g-license"},{id:"c-lic-03",title:"Third-party notices: what to ship with releases",gizmoId:"g-license"}]},{gizmoId:"g-cpp",title:"C++ Foundations",href:"#",conversations:[{id:"c-cpp-01",title:"Modern C++: RAII, smart pointers, and ownership",gizmoId:"g-cpp"},{id:"c-cpp-02",title:"Build systems: CMake patterns that don’t hurt",gizmoId:"g-cpp"},{id:"c-cpp-03",title:"Undefined behavior: why it is worse than bugs",gizmoId:"g-cpp"},{id:"c-cpp-04",title:"Move semantics: when it actually helps",gizmoId:"g-cpp"},{id:"c-cpp-05",title:"Templates: compile-time errors and diagnostics",gizmoId:"g-cpp"}]},{gizmoId:"g-python",title:"Python Tooling",href:"#",conversations:[{id:"c-py-01",title:"Virtualenv vs Poetry vs uv: picking one",gizmoId:"g-python"},{id:"c-py-02",title:"Type hints: mypy/pyright strategy",gizmoId:"g-python"},{id:"c-py-03",title:"FastAPI patterns: dependencies and testing",gizmoId:"g-python"},{id:"c-py-04",title:"Packaging: wheels, sdists, and versioning",gizmoId:"g-python"},{id:"c-py-05",title:"Scripting: CLI ergonomics and config layout",gizmoId:"g-python"},{id:"c-py-06",title:"Data processing: pandas performance basics",gizmoId:"g-python"},{id:"c-py-07",title:"Async: when to use asyncio and when not",gizmoId:"g-python"}]},{gizmoId:"g-docker",title:"Docker & Compose",href:"#",conversations:[{id:"c-dk-01",title:"Compose profiles: clean dev vs prod separation",gizmoId:"g-docker"},{id:"c-dk-02",title:"Healthchecks: making dependencies reliable",gizmoId:"g-docker"},{id:"c-dk-03",title:"Volumes: avoiding permission hell with UID/GID",gizmoId:"g-docker"},{id:"c-dk-04",title:"Build stages: small images and fast rebuilds",gizmoId:"g-docker"},{id:"c-dk-05",title:"Reverse proxy patterns: Apache vs Nginx",gizmoId:"g-docker"},{id:"c-dk-06",title:"Static hosting container: serving dist/ safely",gizmoId:"g-docker"},{id:"c-dk-07",title:"Secrets: env files vs Docker secrets",gizmoId:"g-docker"},{id:"c-dk-08",title:"Network: internal URLs and cross-service calls",gizmoId:"g-docker"}]},{gizmoId:"g-next",title:"Next.js Notes",href:"#",conversations:[{id:"c-next-01",title:"App Router: layouts, pages, and route handlers",gizmoId:"g-next"},{id:"c-next-02",title:"Deployment: build output and runtime configs",gizmoId:"g-next"},{id:"c-next-03",title:"Static assets: serving under a subpath cleanly",gizmoId:"g-next"},{id:"c-next-04",title:"Auth flow: proxy headers and cookie security",gizmoId:"g-next"},{id:"c-next-05",title:"Performance: bundle analysis and caching",gizmoId:"g-next"}]},{gizmoId:"g-rest",title:"REST API Design",href:"#",conversations:[{id:"c-rest-01",title:"Pagination: cursor vs offset",gizmoId:"g-rest"},{id:"c-rest-02",title:"Error formats: consistent error contracts",gizmoId:"g-rest"}]},{gizmoId:"g-uiux",title:"UI/UX for Developer Tools",href:"#",conversations:[{id:"c-ui-01",title:"Progress UI: what users need to trust it",gizmoId:"g-uiux"},{id:"c-ui-02",title:"Confirmation dialogs: reducing destructive mistakes",gizmoId:"g-uiux"},{id:"c-ui-03",title:"Information density: logs that stay readable",gizmoId:"g-uiux"},{id:"c-ui-04",title:"Keyboard navigation: focus order and ARIA basics",gizmoId:"g-uiux"},{id:"c-ui-05",title:"UX copy: writing status messages that aren’t lies",gizmoId:"g-uiux"},{id:"c-ui-06",title:"Empty states: making the UI feel alive",gizmoId:"g-uiux"},{id:"c-ui-07",title:"Filter/search: fast client-side techniques",gizmoId:"g-uiux"},{id:"c-ui-08",title:"Design tokens: theme-aware colors and spacing",gizmoId:"g-uiux"},{id:"c-ui-09",title:"Accessibility: contrast and reduced motion",gizmoId:"g-uiux"},{id:"c-ui-10",title:"Responsive layout: two-column split strategies",gizmoId:"g-uiux"},{id:"c-ui-11",title:"Error feedback: inline vs toast vs log-only",gizmoId:"g-uiux"},{id:"c-ui-12",title:"Consistency: reusable components in the panel",gizmoId:"g-uiux"}]},{gizmoId:"g-testing",title:"Testing & QA",href:"#",conversations:[{id:"c-tst-01",title:"Smoke tests: verifying build artifacts exist",gizmoId:"g-testing"},{id:"c-tst-02",title:"Type-check gates: catching message schema drift",gizmoId:"g-testing"},{id:"c-tst-03",title:"Mocking seams: runtime + storage wrappers",gizmoId:"g-testing"},{id:"c-tst-04",title:"Regression tests: keep demo data stable for screenshots",gizmoId:"g-testing"},{id:"c-tst-05",title:"E2E: controlling flakiness with deterministic fixtures",gizmoId:"g-testing"},{id:"c-tst-06",title:"Error injection: simulate failures and retries",gizmoId:"g-testing"},{id:"c-tst-07",title:"Performance: measuring UI responsiveness",gizmoId:"g-testing"}]},{gizmoId:"g-arch",title:"Architecture & Refactors",href:"#",conversations:[{id:"c-arch-01",title:"Separating platform seams: runtime, storage, fetch",gizmoId:"g-arch"},{id:"c-arch-02",title:"Cache strategy: snapshots and subscriptions",gizmoId:"g-arch"},{id:"c-arch-03",title:"Events vs responses: progress events contract",gizmoId:"g-arch"},{id:"c-arch-04",title:"Logging tiers: audit log vs debug trace",gizmoId:"g-arch"},{id:"c-arch-05",title:"Config handling: dev config vs API config",gizmoId:"g-arch"},{id:"c-arch-06",title:"Keeping code clean: no backward compatibility hacks",gizmoId:"g-arch"},{id:"c-arch-07",title:"Message typing: union composition in shared/messages",gizmoId:"g-arch"},{id:"c-arch-08",title:"Organize tab: confirm UI layout improvements",gizmoId:"g-arch"},{id:"c-arch-09",title:"Scope system: YMD filtering and out-of-scope guard",gizmoId:"g-arch"},{id:"c-arch-10",title:"Release tooling: zip builds and GitHub automation",gizmoId:"g-arch"},{id:"c-arch-11",title:"Demo packaging: dist independence and embedding",gizmoId:"g-arch"}]},{gizmoId:"g-misc",title:"Misc Notes & Scratchpad",href:"#",conversations:[{id:"c-misc-01",title:"Naming: choosing clear message constants",gizmoId:"g-misc"},{id:"c-misc-02",title:"UI polish: microcopy and empty state wording",gizmoId:"g-misc"}]}],singles:[{id:"c-s-01",title:"Quickstart: build and load unpacked extension",gizmoId:""},{id:"c-s-02",title:"Debugging: why a tab click does nothing",gizmoId:""},{id:"c-s-03",title:"Vite: dev vs preview and why it matters",gizmoId:""},{id:"c-s-04",title:"TypeScript error: union event types mismatch",gizmoId:""},{id:"c-s-05",title:"Chrome storage: local vs sync differences",gizmoId:""},{id:"c-s-06",title:"Design: two-column layout for safer confirmations",gizmoId:""},{id:"c-s-07",title:"Security: CSP and embedding via iframe",gizmoId:""},{id:"c-s-08",title:"Git: stash vs commit for interrupted scripts",gizmoId:""},{id:"c-s-09",title:"Release automation: tag + upload assets",gizmoId:""},{id:"c-s-10",title:"Node audit: handling moderate vulnerabilities",gizmoId:""},{id:"c-s-11",title:"Next.js proxy: Apache headers and websocket upgrade",gizmoId:""},{id:"c-s-12",title:"Mocking: seam swap for runtime and storage",gizmoId:""},{id:"c-s-13",title:"API design: progress events contract",gizmoId:""},{id:"c-s-14",title:"UI: logs tab export and trimming strategy",gizmoId:""},{id:"c-s-15",title:"Organize: moving chats to projects workflow",gizmoId:""},{id:"c-s-16",title:"Performance: caching and update throttling",gizmoId:""},{id:"c-s-17",title:"License: choosing MIT vs Apache for a tool",gizmoId:""},{id:"c-s-18",title:"CSS: why panel looks ugly in demo build",gizmoId:""},{id:"c-s-19",title:"Troubleshooting: missing DOM id errors in panel",gizmoId:""}]};function V(){return Date.now()}async function ns(e){switch(e.type){case B.LIST_GIZMO_PROJECTS:{const t=V();W({type:B.LIST_GIZMO_PROJECTS_PROGRESS,foundProjects:0,foundConversations:0}),await oe(150);const o=se.projects.length,n=se.projects.reduce((s,r)=>{var c;return s+(((c=r.conversations)==null?void 0:c.length)||0)},0);return W({type:B.LIST_GIZMO_PROJECTS_DONE,totalProjects:o,totalConversations:n,elapsedMs:V()-t}),{ok:!0,projects:se.projects}}case B.LIST_ALL_CHATS:{const t=V();return W({type:B.LIST_ALL_CHATS_PROGRESS,found:0}),await oe(120),W({type:B.LIST_ALL_CHATS_DONE,total:se.singles.length,elapsedMs:V()-t}),{ok:!0,conversations:se.singles}}case B.EXECUTE_DELETE:{const t=e.ids,o=`run-${V()}`;let n=0;for(const s of t)n++,await oe(80),W({type:B.EXECUTE_DELETE_PROGRESS,runId:o,i:n,total:t.length,id:s,ok:!0,status:200,attempt:1,elapsedMs:0,lastOpMs:80});return W({type:B.EXECUTE_DELETE_DONE,runId:o,total:t.length,okCount:t.length,failCount:0,elapsedMs:0}),{ok:!0}}case B.MOVE_CHATS_TO_PROJECT:{const t=e.ids,o=`run-${V()}`;let n=0;for(const s of t)n++,await oe(90),W({type:B.MOVE_CHATS_TO_PROJECT_PROGRESS,runId:o,i:n,total:t.length,id:s,ok:!0,status:200,elapsedMs:0,lastOpMs:90});return W({type:B.MOVE_CHATS_TO_PROJECT_DONE,runId:o,total:t.length,okCount:t.length,failCount:0,elapsedMs:0}),{ok:!0}}case B.CREATE_PROJECT:return{ok:!0,gizmoId:`g-${V()}`,title:e.name||"New Project",href:"#"};case B.DELETE_PROJECTS:{const t=e.gizmoIds,o=`run-${V()}`;let n=0;for(const s of t)n++,await oe(100),W({type:B.DELETE_PROJECTS_PROGRESS,runId:o,i:n,total:t.length,gizmoId:s,ok:!0,status:200,elapsedMs:0,lastOpMs:100});return W({type:B.DELETE_PROJECTS_DONE,runId:o,total:t.length,okCount:t.length,failCount:0,elapsedMs:0}),{ok:!0}}default:return{ok:!1,error:`Demo handler not implemented for: ${e==null?void 0:e.type}`}}}function oe(e){return new Promise(t=>setTimeout(t,e))}const Ue=new Set;function W(e){for(const t of Ue)t(e)}function ss(e){Ue.add(e)}async function X(e){return await Promise.resolve(ns(e))}function os(){const e=new Set;function t(n){return e.add(n),()=>e.delete(n)}function o(){ss(s=>{for(const r of e)r(s)})}return{on:t,start:o}}function is(e,t){let o="single";function n(a){const u=P=>a===P;e.tabSingle.classList.toggle("is-active",u("single")),e.tabSingle.setAttribute("aria-selected",String(u("single"))),e.viewSingle.hidden=!u("single"),e.tabProjects.classList.toggle("is-active",u("projects")),e.tabProjects.setAttribute("aria-selected",String(u("projects"))),e.viewProjects.hidden=!u("projects"),e.tabSearch.classList.toggle("is-active",u("search")),e.tabSearch.setAttribute("aria-selected",String(u("search"))),e.viewSearch.hidden=!u("search"),e.tabOrganize.classList.toggle("is-active",u("organize")),e.tabOrganize.setAttribute("aria-selected",String(u("organize"))),e.viewOrganize.hidden=!u("organize"),e.tabLogs.classList.toggle("is-active",u("logs")),e.tabLogs.setAttribute("aria-selected",String(u("logs"))),e.viewLogs.hidden=!u("logs"),e.tabStats.classList.toggle("is-active",u("stats")),e.tabStats.setAttribute("aria-selected",String(u("stats"))),e.viewStats.hidden=!u("stats")}function s(a){a!==o&&(t[o].unmount(),o=a,n(o),t[o].mount())}function r(){e.tabSingle.addEventListener("click",()=>s("single")),e.tabProjects.addEventListener("click",()=>s("projects")),e.tabOrganize.addEventListener("click",()=>s("organize")),e.tabSearch.addEventListener("click",()=>s("search")),e.tabLogs.addEventListener("click",()=>s("logs")),e.tabStats.addEventListener("click",()=>s("stats"))}function c(){n(o),t[o].mount()}return{bind:r,boot:c,switchTo:s}}function cs(e){var o;let t=0;for(const n of e)t+=((o=n.conversations)==null?void 0:o.length)||0;return t}function we(e){const t=cs(e.projects),o=e.singleChats.length,n=e.projects.length;return{singleChats:e.singleChats,projects:e.projects,counts:{singleChats:o,projects:n,projectChats:t,totalChats:o+t},meta:e.meta}}function rs(){const e={singleChats:[],projects:[],meta:{}},t=new Set;function o(){const i=we(e);for(const f of t)try{f(i)}catch{}}function n(i){e.meta.scopeUpdatedSince=i,o()}function s(){return String(e.meta.scopeUpdatedSince||"")}function r(){return we(e)}function c(i){t.add(i);try{i(r())}catch{}return()=>t.delete(i)}function a(){e.singleChats=[],e.projects=[],e.meta={},o()}function u(i,f){e.singleChats=i.slice(),e.meta.singleUpdatedTs=Date.now(),typeof(f==null?void 0:f.limit)=="number"&&(e.meta.singleLimit=f.limit),o()}function P(i,f){e.projects=i.slice(),e.meta.projectsUpdatedTs=Date.now(),typeof(f==null?void 0:f.limitProjects)=="number"&&(e.meta.projectsLimit=f.limitProjects),typeof(f==null?void 0:f.chatsPerProject)=="number"&&(e.meta.projectsChatsLimit=f.chatsPerProject),o()}function l(i){var b;const f=e.singleChats.length;e.singleChats=e.singleChats.filter(E=>E.id!==i);let g=!1;const y=[];for(const E of e.projects){const C=((b=E.conversations)==null?void 0:b.length)||0,p=(E.conversations||[]).filter(S=>S.id!==i);p.length!==C&&(g=!0),y.push(C===p.length?E:{...E,conversations:p})}(e.singleChats.length!==f||g)&&(e.projects=y,o())}function h(i){const f=e.projects.length;e.projects=e.projects.filter(g=>g.gizmoId!==i),e.projects.length!==f&&o()}return{getSnapshot:r,subscribe:c,getScopeUpdatedSince:s,clearAll:a,setSingleChats:u,setProjects:P,removeChat:l,removeProject:h,setScopeUpdatedSince:n}}const K=new Map,Pe=new Set;function He(e){for(const t of Pe)t(e,"local")}async function ee(e){if(typeof e=="string")return{[e]:K.get(e)};if(Array.isArray(e)){const o={};for(const n of e)o[n]=K.get(n);return o}const t={};for(const[o,n]of Object.entries(e))t[o]=K.has(o)?K.get(o):n;return t}async function re(e){const t={};for(const[o,n]of Object.entries(e)){const s=K.get(o);K.set(o,n),t[o]={oldValue:s,newValue:n}}He(t)}async function xe(e){const t=Array.isArray(e)?e:[e],o={};for(const n of t){const s=K.get(n);K.delete(n),o[n]={oldValue:s,newValue:void 0}}He(o)}function as(e){Pe.add(e)}function ls(e){Pe.delete(e)}const ge="cgo.actionLog",ds=5e3;function us(){return`${Date.now()}-${Math.random().toString(16).slice(2)}`}function gs(e){return Array.isArray(e)?e:[e]}async function ce(){const e=await ee(ge),t=e==null?void 0:e[ge];return Array.isArray(t)?t:[]}async function Ge(e){await re({[ge]:e})}function fe(e,t,o){return Math.max(t,Math.min(o,Math.floor(e)))}async function Y(e,t){const o=fe(ds,100,5e4),s=gs(e).map(u=>({...u,id:us(),ts:Date.now()}));if(!s.length)return{total:(await ce()).length};const c=(await ce()).concat(s),a=c.length>o?c.slice(c.length-o):c;return await Ge(a),{total:a.length}}async function fs(e){const t=fe((e==null?void 0:e.limit)??200,1,5e4),o=fe((e==null?void 0:e.offset)??0,0,1e6);let s=await ce();e!=null&&e.kind&&(s=s.filter(a=>a.kind===e.kind)),e!=null&&e.scope&&(s=s.filter(a=>a.scope===e.scope)),typeof(e==null?void 0:e.sinceTs)=="number"&&(s=s.filter(a=>a.ts>=e.sinceTs)),typeof(e==null?void 0:e.untilTs)=="number"&&(s=s.filter(a=>a.ts<=e.untilTs));const r=s.length;s=s.slice().reverse();const c=s.slice(o,o+t);return{total:r,items:c}}async function ps(e){let o=await ce();if(typeof e.beforeTs=="number"&&(o=o.filter(n=>n.ts>=e.beforeTs)),typeof e.keepLast=="number"){const n=fe(e.keepLast,0,5e4);n===0?o=[]:o.length>n&&(o=o.slice(o.length-n))}return await Ge(o),{total:o.length}}async function hs(){await xe(ge)}async function ms(e){const t=await ce();return JSON.stringify(t,null,2)}function q(e,t,o,n){const s=Number(String(e??"").trim());return Number.isFinite(s)?Math.max(t,Math.min(o,Math.floor(s))):n}function M(e){return Number.isFinite(e)?e<1e3?`${e}ms`:`${Math.round(e/100)/10}s`:"?"}let Fe=!1;function A(){return Fe}function N(e,t){Fe=t,e.scopeLoadingEl.classList.toggle("is-busy",t),e.btnScopeChange.disabled=t,e.btnScopeRefresh.disabled=t,e.scopeDateEl.disabled=t,e.btnScopeCancel.disabled=t,e.btnScopeApply.disabled=t,e.btnListSingle.disabled=t,e.singleLimitEl.disabled=t,e.cbSingleToggleAll.disabled=t,e.btnSingleDelete.disabled=t,e.btnListProjects.disabled=t,e.projectsLimitEl.disabled=t,e.projectsChatsLimitEl.disabled=t,e.btnProjectsDelete.disabled=t,e.btnSearchListSingle.disabled=t,e.btnSearchListProjects.disabled=t,e.btnSearchResetFilters.disabled=t,e.btnSearchClear.disabled=t,e.searchQueryEl.disabled=t,Array.from(document.querySelectorAll("input[type='checkbox']")).forEach(o=>{o.disabled=t})}function Es(){let e=[];const t=new Set;function o(a){e=a;const u=new Set(e.map(P=>P.id));for(const P of Array.from(t))u.has(P)||t.delete(P)}function n(a,u){u?t.add(a):t.delete(a)}function s(a){if(a)for(const u of e)t.add(u.id);else for(const u of e)t.delete(u.id)}function r(){return e.filter(a=>t.has(a.id)).map(a=>a.id)}function c(a){e=e.filter(u=>u.id!==a),t.delete(a)}return{get chats(){return e},selected:t,setChats:o,toggle:n,toggleAll:s,getSelectedIds:r,removeChat:c}}function Cs(e){function t(l){e.singleStatusEl.textContent=l}function o(l){e.singleExecOutEl.textContent=l}function n(l){const h=e.singleExecOutEl.textContent||"";e.singleExecOutEl.textContent=h?`${h}
${l}`:l,e.singleExecOutEl.scrollTop=e.singleExecOutEl.scrollHeight}function s(l){e.singleExecProgressWrapEl.hidden=!l,l||(e.singleExecProgressEl.value=0,e.singleExecProgressEl.max=100,e.singleExecProgressTextEl.textContent="")}function r(l){e.singleConfirmBoxEl.hidden=!l,l||(e.singleCbConfirmEl.checked=!1,e.singleConfirmTitleEl.textContent="",e.singleConfirmPreviewEl.innerHTML="")}function c(l,h){e.singleCountEl.textContent=String(l.length),e.singleSelectedCountEl.textContent=String(h.size)}function a(l,h){if(!l.length){e.cbSingleToggleAll.checked=!1,e.cbSingleToggleAll.indeterminate=!1;return}const i=l.filter(f=>h.has(f.id)).length;i===0?(e.cbSingleToggleAll.checked=!1,e.cbSingleToggleAll.indeterminate=!1):i===l.length?(e.cbSingleToggleAll.checked=!0,e.cbSingleToggleAll.indeterminate=!1):(e.cbSingleToggleAll.checked=!1,e.cbSingleToggleAll.indeterminate=!0)}function u(l){const{chats:h,selected:i,isBusy:f,onToggleChat:g}=l;e.singleListEl.innerHTML="";for(const y of h){const b=document.createElement("li");b.className="item",b.dataset.id=y.id;const E=document.createElement("div");E.className="left";const C=document.createElement("input");C.type="checkbox",C.className="deleteCb",C.checked=i.has(y.id),C.addEventListener("change",()=>{f||(g(y.id,C.checked),b.classList.toggle("selected",C.checked))}),E.appendChild(C);const p=document.createElement("div");p.className="mid";const S=document.createElement("div");S.className="title",S.textContent=y.title||"Untitled";const d=document.createElement("a");d.className="link",d.href=y.href,d.textContent=y.href,d.target="_blank",d.rel="noreferrer",p.appendChild(S),p.appendChild(d),b.appendChild(E),b.appendChild(p),b.classList.toggle("selected",i.has(y.id)),e.singleListEl.appendChild(b)}c(h,i),a(h,i)}function P(l,h){const i=l.filter(b=>h.includes(b.id)),f=i.length,g=i.slice(0,5);e.singleConfirmTitleEl.textContent=`You are about to delete: ${f} chat${f===1?"":"s"}`,e.singleConfirmPreviewEl.innerHTML="";for(const b of g){const E=document.createElement("li");E.textContent=b.title||"Untitled",e.singleConfirmPreviewEl.appendChild(E)}const y=f-g.length;if(y>0){const b=document.createElement("li");b.textContent=`and ${y} more…`,e.singleConfirmPreviewEl.appendChild(b)}e.singleCbConfirmEl.checked=!1,e.singleBtnConfirmExecute.textContent=`Yes, delete ${f}`}return{setStatus:t,writeExecOut:o,appendExecOut:n,showExecProgress:s,showConfirm:r,updateCounts:c,updateToggleAllState:a,renderList:u,renderConfirmPreview:P}}const pe="cgo_stats_v1";function Q(e){const t=Number(e);return Number.isFinite(t)&&t>0?Math.floor(t):0}async function Te(){try{const e=await ee(pe),t=(e==null?void 0:e[pe])||{};return{deletedChats:Q(t.deletedChats),deletedProjects:Q(t.deletedProjects)}}catch{return{deletedChats:0,deletedProjects:0}}}async function Je(e){await re({[pe]:{deletedChats:Q(e.deletedChats),deletedProjects:Q(e.deletedProjects)}})}async function We(e=1){const t=await Te(),o={...t,deletedChats:t.deletedChats+Math.max(1,Q(e))};return await Je(o),o}async function Ss(e=1){const t=await Te(),o={...t,deletedProjects:t.deletedProjects+Math.max(1,Q(e))};return await Je(o),o}function bs(e,t,o){const n=Es(),s=Cs(e);let r=null,c=0,a=0,u=0,P=0;const l=50;function h(){var j;const d=typeof o.getScopeUpdatedSince=="function"?o.getScopeUpdatedSince():"";return d||((j=e.scopeDateEl)==null?void 0:j.value)||""}function i(d){r=null,c=0,a=0,u=d,P=0,s.showExecProgress(!0),e.singleExecProgressEl.max=d,e.singleExecProgressEl.value=0,e.singleExecProgressTextEl.textContent=`Starting… 0/${d}`,s.setStatus("Deleting chats…")}function f(d,j,v,w,T){e.singleExecProgressEl.max=j,e.singleExecProgressEl.value=Math.min(d,j),e.singleExecProgressTextEl.textContent=`Deleting ${d}/${j} · ok ${v} · failed ${w} · last ${M(T)}`}function g(d){s.setStatus(""),e.singleExecProgressTextEl.textContent=d}async function y(){s.showConfirm(!1),s.writeExecOut(""),s.setStatus("Loading single chats…"),N(e,!0);const d=q(e.singleLimitEl.value,1,5e4,50),j=h();console.log("[CGO][scope] panel->background LIST_ALL_CHATS",{scopeYmd:j,limit:d,pageSize:50});const v=await X({type:B.LIST_ALL_CHATS}).catch(()=>null);if(N(e,!1),!v){s.setStatus("Loading single chats failed (no response).");return}if(!v.ok){s.setStatus(`Loading single chats failed: ${v.error}`);return}const w=v.conversations||[];n.setChats(w.filter(T=>!T.gizmoId)),o.setSingleChats(n.chats,{limit:d}),s.renderList({chats:n.chats,selected:n.selected,isBusy:A(),onToggleChat:(T,L)=>{n.toggle(T,L),s.updateCounts(n.chats,n.selected),s.updateToggleAllState(n.chats,n.selected)}}),s.setStatus("")}function b(){const d=n.getSelectedIds();if(!d.length){s.writeExecOut("Nothing selected.");return}s.renderConfirmPreview(n.chats,d),s.showConfirm(!0)}async function E(){const d=n.getSelectedIds();if(!d.length){s.writeExecOut("Nothing selected.");return}s.writeExecOut(""),s.appendExecOut(`EXECUTE: deleting ${d.length} chat(s)…`),i(d.length),N(e,!0),X({type:B.EXECUTE_DELETE,ids:d}).catch(()=>null)}function C(){if(A()||!n.chats.length)return;const j=n.chats.filter(v=>n.selected.has(v.id)).length===n.chats.length;n.toggleAll(!j),s.renderList({chats:n.chats,selected:n.selected,isBusy:A(),onToggleChat:(v,w)=>{n.toggle(v,w),s.updateCounts(n.chats,n.selected),s.updateToggleAllState(n.chats,n.selected)}})}const p=t.on(d=>{var j;if((d==null?void 0:d.type)===B.EXECUTE_DELETE_PROGRESS){const v=d;if(r||(r=v.runId),r!==v.runId)return;const w=Number(v.i||0),T=Number(v.total||u),L=String(v.id||""),m=!!v.ok,x=v.status,O=v.error,$=Number(v.attempt||1),I=Number(v.elapsedMs||0),z=Number(v.lastOpMs||0);m?c++:a++,f(w,T,c,a,z);const D=((j=n.chats.find(_=>_.id===L))==null?void 0:j.title)||L.slice(0,8),k=m?`✓ ${D} (${L.slice(0,8)}) — ${x??"OK"} — ${M(z)} — elapsed ${M(I)}`:`✗ ${D} (${L.slice(0,8)}) — ${x??"ERR"} — attempt ${$} — ${O||"failed"} — elapsed ${M(I)}`;s.appendExecOut(k),!m&&P<l&&(P++,Y({kind:"error",scope:"single",message:`Delete chat failed: ${D} (${L.slice(0,8)})`,ok:!1,status:x,error:O||"failed",chatId:L,chatTitle:D,meta:{attempt:$,elapsedMs:I,lastOpMs:z}}).catch(()=>{})),m&&(n.removeChat(L),o.removeChat(L),We(1).catch(()=>{}),s.renderList({chats:n.chats,selected:n.selected,isBusy:A(),onToggleChat:(_,H)=>{n.toggle(_,H),s.updateCounts(n.chats,n.selected),s.updateToggleAllState(n.chats,n.selected)}}));return}if((d==null?void 0:d.type)===B.EXECUTE_DELETE_DONE){const v=d;if(r||(r=v.runId),r!==v.runId)return;const w=Number(v.total||u),T=Number(v.okCount||c),L=Number(v.failCount||a),m=Number(v.elapsedMs||0);Y({kind:"run",scope:"single",message:`Delete run finished: ok ${T}/${w}, failed ${L}, elapsed ${M(m)}`,ok:L===0,meta:{total:w,okCount:T,failCount:L,elapsedMs:m}}).catch(()=>{}),P=0,g(`Done · ok ${T}/${w} · failed ${L} · elapsed ${M(m)}`),N(e,!1),r=null;return}});function S(){e.cbSingleToggleAll.addEventListener("change",()=>C()),e.btnSingleDelete.addEventListener("click",()=>{A()||b()}),e.singleBtnCancelExecute.addEventListener("click",()=>s.showConfirm(!1)),e.singleBtnConfirmExecute.addEventListener("click",()=>{if(!e.singleCbConfirmEl.checked){s.writeExecOut("Blocked: tick the confirmation checkbox.");return}s.showConfirm(!1),E().catch(d=>{s.writeExecOut(`Execute crashed: ${(d==null?void 0:d.message)||d}`),N(e,!1)})})}return{id:"single",refresh(){A()||y().catch(d=>s.setStatus(`Error: ${(d==null?void 0:d.message)||d}`))},mount(){},unmount(){},bind:S,dispose(){p()}}}function ys(){let e=[];const t=new Set,o=new Set;function n(l){e=l;const h=new Set(e.map(f=>f.gizmoId));for(const f of Array.from(t))h.has(f)||t.delete(f);const i=new Set(e.flatMap(f=>(f.conversations||[]).map(g=>g.id)));for(const f of Array.from(o))i.has(f)||o.delete(f)}function s(l){return(l.conversations||[]).map(h=>h.id)}function r(l,h){if(h){t.add(l.gizmoId);for(const i of s(l))o.add(i)}else{t.delete(l.gizmoId);for(const i of s(l))o.delete(i)}}function c(l,h){h?o.add(l):o.delete(l)}function a(l){o.delete(l);for(const h of e)h.conversations=(h.conversations||[]).filter(i=>i.id!==l)}function u(l){t.delete(l),e=e.filter(h=>h.gizmoId!==l)}function P(){return e.reduce((l,h)=>l+(h.conversations||[]).length,0)}return{get projects(){return e},selectedProjectIds:t,selectedProjectChatIds:o,setProjects:n,toggleProjectSelection:r,toggleChatSelection:c,removeChatEverywhere:a,removeProject:u,getTotalChats:P}}function Is(e){function t(l){e.projectsStatusEl.textContent=l}function o(l){e.projectsExecOutEl.textContent=l}function n(l){const h=e.projectsExecOutEl.textContent||"";e.projectsExecOutEl.textContent=h?`${h}
${l}`:l,e.projectsExecOutEl.scrollTop=e.projectsExecOutEl.scrollHeight}function s(l){e.projectsChatsExecProgressWrapEl.hidden=!l,l||(e.projectsChatsExecProgressEl.value=0,e.projectsChatsExecProgressEl.max=100,e.projectsChatsExecProgressTextEl.textContent="")}function r(l){e.projectsProjectsExecProgressWrapEl.hidden=!l,l||(e.projectsProjectsExecProgressEl.value=0,e.projectsProjectsExecProgressEl.max=100,e.projectsProjectsExecProgressTextEl.textContent="")}function c(l){e.projectsConfirmBoxEl.hidden=!l,l||(e.projectsCbConfirmEl.checked=!1,e.projectsConfirmTitleEl.textContent="",e.projectsConfirmPreviewEl.innerHTML="")}function a(l){e.projectsCountEl.textContent=String(l.projects.length),e.projectsChatsCountEl.textContent=String(l.totalChats),e.projectsSelectedChatsCountEl.textContent=String(l.selectedChatsCount),e.projectsSelectedProjectsCountEl.textContent=String(l.selectedProjectsCount)}function u(l){var p;const{projects:h,selectedProjectIds:i,selectedProjectChatIds:f,isBusy:g,onToggleProject:y,onToggleChat:b,afterProjectToggle:E,afterChatToggle:C}=l;e.projectsListEl.innerHTML="";for(const S of h){const d=document.createElement("li");d.className="projectCard",d.dataset.gizmoId=S.gizmoId;const j=document.createElement("div");j.className="projectHead";const v=document.createElement("div"),w=document.createElement("div");w.className="title",w.textContent=`${S.title} (${((p=S.conversations)==null?void 0:p.length)||0})`;const T=document.createElement("a");T.className="link",T.href=S.href,T.target="_blank",T.rel="noreferrer",T.textContent=S.href,v.appendChild(w),v.appendChild(T);const L=document.createElement("label");L.className="projectPick";const m=document.createElement("input");m.type="checkbox",m.checked=i.has(S.gizmoId),m.addEventListener("change",()=>{g||(y(S,m.checked),E())});const x=document.createElement("span");x.textContent="Select project (delete project + its chats)",L.appendChild(m),L.appendChild(x),j.appendChild(v),j.appendChild(L);const O=document.createElement("details"),$=document.createElement("summary");$.textContent="Show conversations",O.appendChild($);const I=document.createElement("ul");I.className="list",I.style.marginTop="8px";for(const z of S.conversations||[]){const D=document.createElement("li");D.className="item",D.style.gridTemplateColumns="28px 1fr";const k=document.createElement("div");k.className="left";const _=document.createElement("input");_.type="checkbox",_.className="deleteCb";const H=i.has(S.gizmoId);_.checked=H||f.has(z.id),_.addEventListener("change",()=>{if(!g){if(i.has(S.gizmoId)){_.checked=!0;return}b(S,z.id,_.checked),C()}}),k.appendChild(_);const G=document.createElement("div"),U=document.createElement("div");U.className="title",U.textContent=z.title||"Untitled";const R=document.createElement("a");R.className="link",R.href=z.href,R.target="_blank",R.rel="noreferrer",R.textContent=z.href,G.appendChild(U),G.appendChild(R),D.appendChild(k),D.appendChild(G),I.appendChild(D)}O.appendChild(I),d.appendChild(j),d.appendChild(O),e.projectsListEl.appendChild(d)}}function P(l){const{projects:h,selectedProjectIds:i,selectedChatIds:f}=l;e.projectsConfirmPreviewEl.innerHTML="";const g=[];i.length&&g.push(`${i.length} project(s)`),f.length&&g.push(`${f.length} chat(s)`),e.projectsConfirmTitleEl.textContent=`You are about to delete: ${g.join(" + ")}`;const y=i.slice(0,5);for(const E of y){const C=h.find(S=>S.gizmoId===E);if(!C)continue;const p=document.createElement("li");p.textContent=`Project: ${C.title}`,e.projectsConfirmPreviewEl.appendChild(p)}if(i.length>y.length){const E=document.createElement("li");E.textContent=`…and ${i.length-y.length} more projects`,e.projectsConfirmPreviewEl.appendChild(E)}const b=f.slice(0,5);for(const E of b){const C=h.flatMap(S=>S.conversations||[]).find(S=>S.id===E),p=document.createElement("li");p.textContent=`Chat: ${(C==null?void 0:C.title)||E.slice(0,8)}`,e.projectsConfirmPreviewEl.appendChild(p)}if(f.length>b.length){const E=document.createElement("li");E.textContent=`…and ${f.length-b.length} more chats`,e.projectsConfirmPreviewEl.appendChild(E)}e.projectsCbConfirmEl.checked=!1,e.projectsBtnConfirmExecute.textContent="Yes, delete"}return{setStatus:t,writeExecOut:o,appendExecOut:n,showChatsExecProgress:s,showProjectsExecProgress:r,showConfirm:c,updateCounts:a,renderList:u,renderConfirmPreview:P}}function ae(e,t){const o=e.querySelector(t);if(!o)throw new Error(`[createProjectBox] Missing ${t}`);return o}function Ve(e){const{context:t,title:o=t==="organize"?"Create new project":"Create a new project",compact:n=t==="organize",namePlaceholder:s="e.g. general",descPlaceholder:r=t==="organize"?"Optional description…":"Short description shown in ChatGPT projects…",submitLabel:c=t==="organize"?"Create":"Create project"}=e,a=document.createElement("details");a.className=`createBox${n?" createBox--compact":""}`,a.open=!1,a.innerHTML=`
    <summary>${ye(o)}</summary>

    <div class="createGrid">
      <label class="fieldBlock">
        <span>Project name</span>
        <input data-role="name" type="text" autocomplete="off" maxlength="80" placeholder="${Oe(s)}" />
      </label>

      <label class="fieldBlock">
        <span>Description (optional)</span>
        <textarea data-role="desc" rows="${n?"2":"3"}" placeholder="${Oe(r)}"></textarea>
      </label>

      <div class="row createActions">
        <button data-role="submit" type="button" class="subtle">${ye(c)}</button>
        <span data-role="status" class="status"></span>
      </div>
    </div>
  `;const u=ae(a,'[data-role="name"]'),P=ae(a,'[data-role="desc"]'),l=ae(a,'[data-role="submit"]'),h=ae(a,'[data-role="status"]');function i(){return{name:u.value.trim(),description:P.value.trim()}}function f(C){u.disabled=C,P.disabled=C,l.disabled=C}function g(C){h.textContent=C}function y(){h.textContent=""}function b(){u.value="",P.value="",y()}function E(){y();const{name:C,description:p}=i();if(!C){g("Name is required."),u.focus();return}const S={name:C,description:p,context:t};a.dispatchEvent(new CustomEvent("cgo:createProject",{bubbles:!0,detail:S}))}return l.addEventListener("click",E),u.addEventListener("keydown",C=>{C.key==="Enter"&&(C.preventDefault(),E())}),{el:a,setBusy:f,setStatus:g,clearStatus:y,reset:b,getValue:i}}function ye(e){return e.replace(/[&<>"']/g,t=>{switch(t){case"&":return"&amp;";case"<":return"&lt;";case">":return"&gt;";case'"':return"&quot;";case"'":return"&#39;";default:return t}})}function Oe(e){return ye(e)}function Xe(){window.dispatchEvent(new Event("cgo:refreshAll"))}function js(e,t,o){const n=ys(),s=Is(e);let r=null,c=0,a=0,u=0,P=null,l=0,h=0,i=0,f=0;const g=50;function y(){var x;const m=typeof o.getScopeUpdatedSince=="function"?o.getScopeUpdatedSince():"";return m||((x=e.scopeDateEl)==null?void 0:x.value)||""}function b(){s.updateCounts({projects:n.projects,totalChats:n.getTotalChats(),selectedChatsCount:n.selectedProjectChatIds.size,selectedProjectsCount:n.selectedProjectIds.size})}function E(){s.renderList({projects:n.projects,selectedProjectIds:n.selectedProjectIds,selectedProjectChatIds:n.selectedProjectChatIds,isBusy:A(),onToggleProject:(m,x)=>n.toggleProjectSelection(m,x),onToggleChat:(m,x,O)=>n.toggleChatSelection(x,O),afterProjectToggle:()=>{b(),E()},afterChatToggle:()=>{b()}}),b()}async function C(){s.showConfirm(!1),s.writeExecOut(""),s.setStatus("Projects loading… 0 project(s), 0 chat(s)"),N(e,!0);const m=q(e.projectsLimitEl.value,1,5e3,50),x=q(e.projectsChatsLimitEl.value,1,5e3,200),O=y(),$=5,I=q(e.projectsChatsLimitEl.value,1,5e4,5e3);console.log("[CGO][scope] panel->background LIST_GIZMO_PROJECTS",{scopeYmd:O,limitProjects:m,conversationsPerGizmo:$,perProjectLimit:I,uiMaxChatsPerProject:x});const z=await X({type:B.LIST_GIZMO_PROJECTS}).catch(()=>null);if(N(e,!1),!z){s.setStatus("Projects loading failed (no response).");return}if(!z.ok){s.setStatus(`Projects loading failed: ${z.error}`);return}const D=z.projects||[];n.setProjects(D.map(k=>({...k,conversations:(k.conversations||[]).slice(0,x)}))),o.setProjects(n.projects,{limitProjects:m,chatsPerProject:x}),E(),s.setStatus("")}function p(){const m=Array.from(n.selectedProjectChatIds),x=Array.from(n.selectedProjectIds);if(!m.length&&!x.length){s.writeExecOut("Nothing selected.");return}s.renderConfirmPreview({projects:n.projects,selectedProjectIds:x,selectedChatIds:m}),s.showConfirm(!0)}function S(m){r=null,c=0,a=0,u=m,f=0,s.showChatsExecProgress(!0),e.projectsChatsExecProgressEl.max=m,e.projectsChatsExecProgressEl.value=0,e.projectsChatsExecProgressTextEl.textContent=`Deleting chats… 0/${m}`,s.setStatus("Deleting chats…")}function d(m){P=null,l=0,h=0,i=m,f=0,s.showProjectsExecProgress(!0),e.projectsProjectsExecProgressEl.max=m,e.projectsProjectsExecProgressEl.value=0,e.projectsProjectsExecProgressTextEl.textContent=`Deleting projects… 0/${m}`}async function j(m){m.length&&(S(m.length),N(e,!0),X({type:B.EXECUTE_DELETE,ids:m}).catch(()=>null))}async function v(m){m.length&&(d(m.length),X({type:B.DELETE_PROJECTS,gizmoIds:m}).catch(()=>null))}async function w(){const m=Array.from(n.selectedProjectChatIds),x=Array.from(n.selectedProjectIds);if(!m.length&&!x.length){s.writeExecOut("Nothing selected.");return}window.__cgo_projectsDeletePlan={selectedProjects:x},s.writeExecOut(""),s.appendExecOut(`EXECUTE: deleting ${m.length} conversation(s)…`),x.length&&s.appendExecOut(`Then attempting to delete ${x.length} project(s) (only if empty).`),await j(m)}const T=t.on(m=>{var x,O,$;if((m==null?void 0:m.type)===B.LIST_GIZMO_PROJECTS_PROGRESS){const I=m,z=Number(I.foundProjects||0),D=Number(I.foundConversations||0);s.setStatus(`Projects loading… ${z} project(s), ${D} chat(s)`);return}if((m==null?void 0:m.type)===B.LIST_GIZMO_PROJECTS_DONE){const I=m;Number(I.totalProjects||0),Number(I.totalConversations||0),Number(I.elapsedMs||0),s.setStatus("");return}if((m==null?void 0:m.type)===B.EXECUTE_DELETE_PROGRESS){const I=m;if(r||(r=I.runId),r!==I.runId)return;const z=Number(I.i||0),D=Number(I.total||u),k=String(I.id||""),_=!!I.ok,H=I.status,G=I.error,U=Number(I.attempt||1),R=Number(I.elapsedMs||0),F=Number(I.lastOpMs||0);_?c++:a++,e.projectsChatsExecProgressEl.max=D,e.projectsChatsExecProgressEl.value=Math.min(z,D),e.projectsChatsExecProgressTextEl.textContent=`Deleting chats ${z}/${D} · ok ${c} · failed ${a} · last ${M(F)}`;const J=((x=n.projects.flatMap(ne=>ne.conversations||[]).find(ne=>ne.id===k))==null?void 0:x.title)||k.slice(0,8),te=_?`✓ ${J} (${k.slice(0,8)}) — ${H??"OK"} — ${M(F)} — elapsed ${M(R)}`:`✗ ${J} (${k.slice(0,8)}) — ${H??"ERR"} — attempt ${U} — ${G||"failed"} — elapsed ${M(R)}`;s.appendExecOut(te),_&&(n.removeChatEverywhere(k),o.removeChat(k),We(1).catch(()=>{}),E()),!_&&f<g&&(f++,Y({kind:"error",scope:"projects",message:`Delete chat failed: ${J} (${k.slice(0,8)})`,ok:!1,status:H,error:G||"failed",chatId:k,chatTitle:J,meta:{attempt:U,elapsedMs:R,lastOpMs:F}}).catch(()=>{}));return}if((m==null?void 0:m.type)===B.EXECUTE_DELETE_DONE){const I=m;if(r||(r=I.runId),r!==I.runId)return;const z=Number(I.total||u),D=Number(I.okCount||c),k=Number(I.failCount||a),_=Number(I.elapsedMs||0);Y({kind:"run",scope:"projects",message:`Projects chat-delete run finished: ok ${D}/${z}, failed ${k}, elapsed ${M(_)}`,ok:k===0,meta:{total:z,okCount:D,failCount:k,elapsedMs:_}}).catch(()=>{}),f=0,s.setStatus("Chats delete done"),e.projectsChatsExecProgressTextEl.textContent=`Done · ok ${D}/${z} · failed ${k} · elapsed ${M(_)}`,N(e,!1);const H=window.__cgo_projectsDeletePlan;if(window.__cgo_projectsDeletePlan=void 0,(O=H==null?void 0:H.selectedProjects)!=null&&O.length){const G=[];for(const U of H.selectedProjects){const R=n.projects.find(J=>J.gizmoId===U);if(!R)continue;const F=(R.conversations||[]).length;F===0?G.push(U):s.appendExecOut(`SKIP PROJECT: ${R.title} — ${F} chat(s) still present.`)}G.length&&(s.appendExecOut(""),s.appendExecOut(`Deleting ${G.length} project(s)…`),window.__cgo_projectNameById=Object.fromEntries(G.map(U=>{const R=n.projects.find(F=>F.gizmoId===U);return[U,(R==null?void 0:R.title)||U]})),v(G))}r=null;return}if((m==null?void 0:m.type)===B.DELETE_PROJECTS_PROGRESS){const I=m;if(P||(P=I.runId),P!==I.runId)return;const z=Number(I.i||0),D=Number(I.total||i),k=String(I.gizmoId||""),_=!!I.ok,H=I.status,G=I.error,U=Number(I.elapsedMs||0),R=Number(I.lastOpMs||0);_?l++:h++,e.projectsProjectsExecProgressEl.max=D,e.projectsProjectsExecProgressEl.value=Math.min(z,D),e.projectsProjectsExecProgressTextEl.textContent=`Deleting projects ${z}/${D} · ok ${l} · failed ${h} · last ${M(R)}`;const F=window.__cgo_projectNameById,J=(F==null?void 0:F[k])||(($=n.projects.find(te=>te.gizmoId===k))==null?void 0:$.title)||k;_?(s.appendExecOut(`✓ PROJECT DELETED: ${J} (${k}) — ${H??"OK"} — ${M(R)} — elapsed ${M(U)}`),n.removeProject(k),o.removeProject(k),Ss(1).catch(()=>{}),E()):(s.appendExecOut(`✗ PROJECT FAILED: ${J} (${k}) — ${H??""} — ${G||"failed"} — elapsed ${M(U)}`),f<g&&(f++,Y({kind:"error",scope:"projects",message:`Delete project failed: ${J}`,ok:!1,status:H,error:G||"failed",projectId:k,projectTitle:J,meta:{elapsedMs:U,lastOpMs:R}}).catch(()=>{})));return}if((m==null?void 0:m.type)===B.DELETE_PROJECTS_DONE){const I=m;if(P||(P=I.runId),P!==I.runId)return;const z=Number(I.total||i),D=Number(I.okCount||l),k=Number(I.failCount||h),_=Number(I.elapsedMs||0);e.projectsProjectsExecProgressTextEl.textContent=`Done · ok ${D}/${i||z} · failed ${k} · elapsed ${M(_)}`,P=null,window.__cgo_projectNameById=void 0;return}});function L(){e.btnProjectsDelete.addEventListener("click",()=>{A()||p()}),e.projectsBtnCancelExecute.addEventListener("click",()=>s.showConfirm(!1)),e.projectsBtnConfirmExecute.addEventListener("click",()=>{if(!e.projectsCbConfirmEl.checked){s.writeExecOut("Blocked: tick the confirmation checkbox.");return}s.showConfirm(!1),w().catch(x=>{s.writeExecOut(`Execute crashed: ${(x==null?void 0:x.message)||x}`),N(e,!1)})});const m=Ve({context:"projects"});e.mountCreateProjectProjectsEl.replaceChildren(m.el),m.el.addEventListener("cgo:createProject",x=>{const O=x;(async()=>{if(A())return;const{name:$,description:I}=O.detail;m.setBusy(!0),m.setStatus("Creating…");try{const z=await X({type:B.CREATE_PROJECT,name:$,description:I,prompt_starters:[]});if(!z){m.setStatus("Create failed (no response).");return}if(!z.ok){m.setStatus(`Create failed: ${z.error||"unknown error"}`);return}m.setStatus("Created."),m.reset(),Xe()}catch(z){m.setStatus(`Create failed: ${(z==null?void 0:z.message)||z}`)}finally{m.setBusy(!1)}})()})}return{id:"projects",refresh(){A()||C().catch(m=>s.setStatus(`Error: ${(m==null?void 0:m.message)||m}`))},mount(){},unmount(){},bind:L,dispose(){T()}}}function vs(){let e=[],t=[],o="all",n="",s="";const r=new Set;let c=null;function a(E){e=E.singleChats||[],t=E.projects||[];const C=new Set;for(const p of e)C.add(p.id);for(const p of t)for(const S of p.conversations||[])C.add(S.id);for(const p of Array.from(r))C.has(p)||r.delete(p);c&&(t.some(S=>S.gizmoId===c)||(c=null))}function u(E){o=E}function P(E){n=E||""}function l(E){s=E||""}function h(E,C){C?r.add(E):r.delete(E)}function i(E){c=E}function f(){c=null}function g(){return c&&t.find(E=>E.gizmoId===c)||null}function y(){const E=[];if(o==="all"||o==="single")for(const p of e)E.push({...p,origin:"single"});if(o==="all"||o==="projects")for(const p of t)for(const S of p.conversations||[])E.push({...S,origin:"project",projectId:p.gizmoId,projectTitle:p.title});const C=n.trim().toLowerCase();return C?E.filter(p=>{const S=(p.title||"").toLowerCase(),d=(p.href||"").toLowerCase(),j=(p.projectTitle||"").toLowerCase();return S.includes(C)||d.includes(C)||j.includes(C)}):E}function b(){const E=s.trim().toLowerCase();return E?t.filter(C=>(C.title||"").toLowerCase().includes(E)):t}return{setFromCache:a,get sourceMode(){return o},setSourceMode:u,setFilter:P,setProjectFilter:l,selectedChatIds:r,toggleChat:h,get targetProjectId(){return c},setTargetProject:i,clearTargetProject:f,getTargetProject:g,buildSourceChats:y,buildProjects:b}}function Ps(e){function t(i){e.btnOrganizeMove.disabled=!i,e.organizeBtnConfirmExecute.disabled=!i,e.organizeBtnCancelExecute.disabled=!i,e.organizeSourceEl.disabled=!i,e.organizeFilterEl.disabled=!i,e.organizeProjectFilterEl.disabled=!i,e.cbOrganizeToggleAll.disabled=!i,e.btnOrganizeClearTarget.disabled=!i}function o(i){e.organizeSourceStatusEl.textContent=i}function n(i){e.organizeProjectsStatusEl.textContent=i}function s(i){e.organizeSourceCountEl.textContent=String(i.sourceCount),e.organizeSelectedCountEl.textContent=String(i.selectedCount),e.organizeProjectsCountEl.textContent=String(i.projectsCount),e.organizeTargetLabelEl.textContent=i.targetLabel||"—"}function r(i){e.organizeExecOutEl.textContent=i}function c(i){const f=e.organizeExecOutEl.textContent||"";e.organizeExecOutEl.textContent=f?`${f}
${i}`:i,e.organizeExecOutEl.scrollTop=e.organizeExecOutEl.scrollHeight}function a(i){e.organizeExecProgressWrapEl.hidden=!i,i||(e.organizeExecProgressEl.value=0,e.organizeExecProgressEl.max=100,e.organizeExecProgressTextEl.textContent="")}function u(i){e.organizeConfirmBoxEl.hidden=!i,i||(e.organizeCbConfirmEl.checked=!1,e.organizeConfirmTitleEl.textContent="",e.organizeConfirmPreviewEl.innerHTML="")}function P(i){e.organizeSourceListEl.innerHTML="";for(const f of i.chats){const g=document.createElement("li");g.className="item",g.style.gridTemplateColumns="28px 1fr";const y=document.createElement("div");y.className="left";const b=document.createElement("input");b.type="checkbox",b.checked=i.selectedIds.has(f.id),b.addEventListener("change",()=>{i.isBusy||i.onToggle(f.id,b.checked)}),y.appendChild(b);const E=document.createElement("div"),C=document.createElement("div");C.className="title",C.textContent=f.title||"Untitled";const p=document.createElement("div");p.className="muted",p.style.fontSize="12px",p.textContent=f.origin==="single"?"Single chat":`Project chat · ${f.projectTitle||f.projectId||"—"}`;const S=document.createElement("a");S.className="link",S.href=f.href,S.target="_blank",S.rel="noreferrer",S.textContent=f.href,E.appendChild(C),E.appendChild(p),E.appendChild(S),g.appendChild(y),g.appendChild(E),e.organizeSourceListEl.appendChild(g)}}function l(i){e.organizeProjectListEl.innerHTML="";for(const f of i.projects){const g=document.createElement("li");g.className="item",g.style.gridTemplateColumns="28px 1fr";const y=document.createElement("div");y.className="left";const b=document.createElement("input");b.type="radio",b.name="organizeTargetProject",b.checked=i.targetProjectId===f.gizmoId,b.addEventListener("change",()=>{i.isBusy||b.checked&&i.onPick(f.gizmoId)}),y.appendChild(b);const E=document.createElement("div"),C=document.createElement("div");C.className="title",C.textContent=f.title||"Untitled project";const p=document.createElement("div");p.className="muted",p.style.fontSize="12px",p.textContent=`${(f.conversations||[]).length} chat(s) loaded`;const S=document.createElement("a");S.className="link",S.href=f.href,S.target="_blank",S.rel="noreferrer",S.textContent=f.href,E.appendChild(C),E.appendChild(p),E.appendChild(S),g.appendChild(y),g.appendChild(E),e.organizeProjectListEl.appendChild(g)}}function h(i){e.organizeConfirmPreviewEl.innerHTML="",e.organizeConfirmTitleEl.textContent=`Move ${i.selectedChats.length} chat(s) → “${i.target.title||"Untitled project"}”`;const f=i.selectedChats.slice(0,5);for(const g of f){const y=document.createElement("li");y.textContent=g.title||g.id.slice(0,8),e.organizeConfirmPreviewEl.appendChild(y)}if(i.selectedChats.length>f.length){const g=document.createElement("li");g.textContent=`…and ${i.selectedChats.length-f.length} more`,e.organizeConfirmPreviewEl.appendChild(g)}e.organizeCbConfirmEl.checked=!1,e.organizeBtnConfirmExecute.textContent="Yes, move"}return{setActionsEnabled:t,setSourceStatus:o,setProjectsStatus:n,setCounts:s,writeExecOut:r,appendExecOut:c,showExecProgress:a,showConfirm:u,renderSourceList:P,renderProjectList:l,renderConfirmPreview:h}}function xs(e,t,o){const n=vs(),s=Ps(e);let r=null,c=null,a=0,u=0,P=0,l=0;const h=50;function i(d){c=null,a=0,u=0,P=d,l=0,s.setActionsEnabled(!1),s.showExecProgress(!0),e.organizeExecProgressEl.max=d,e.organizeExecProgressEl.value=0,e.organizeExecProgressTextEl.textContent=`Moving chats… 0/${d}`,s.writeExecOut(""),s.appendExecOut("EXECUTE MOVE (about to run)")}async function f(d,j){d.length&&(i(d.length),N(e,!0),X({type:B.MOVE_CHATS_TO_PROJECT,ids:d}).catch(()=>null))}const g=t.on(d=>{if((d==null?void 0:d.type)===B.MOVE_CHATS_TO_PROJECT_PROGRESS){const j=d;if(c||(c=j.runId),c!==j.runId)return;const v=Number(j.i||0),w=Number(j.total||P),T=String(j.id||""),L=!!j.ok,m=j.status,x=j.error,O=Number(j.elapsedMs||0),$=Number(j.lastOpMs||0);L?a++:u++,e.organizeExecProgressEl.max=w,e.organizeExecProgressEl.value=Math.min(v,w),e.organizeExecProgressTextEl.textContent=`Moving ${v}/${w} · ok ${a} · failed ${u} · last ${M($)}`;const I=L?`✓ ${T.slice(0,8)} — ${m??"OK"} — ${M($)} — elapsed ${M(O)}`:`✗ ${T.slice(0,8)} — ${m??"ERR"} — ${x||"failed"} — elapsed ${M(O)}`;s.appendExecOut(I),!L&&l<h&&(l++,Y({kind:"error",scope:"organize",message:`Move chat failed (${T.slice(0,8)})`,ok:!1,status:m,error:x||"failed",chatId:T,meta:{elapsedMs:O,lastOpMs:$}}).catch(()=>{}));return}if((d==null?void 0:d.type)===B.MOVE_CHATS_TO_PROJECT_DONE){const j=d;if(c||(c=j.runId),c!==j.runId)return;const v=Number(j.total||P),w=Number(j.okCount||a),T=Number(j.failCount||u),L=Number(j.elapsedMs||0);s.setActionsEnabled(!0),s.appendExecOut(""),s.appendExecOut(`DONE · ok ${w}/${v} · failed ${T} · elapsed ${M(L)}`),Y({kind:"run",scope:"organize",message:`Move run finished: ok ${w}/${v}, failed ${T}, elapsed ${M(L)}`,ok:T===0,meta:{total:v,okCount:w,failCount:T,elapsedMs:L}}).catch(()=>{}),s.showExecProgress(!1),N(e,!1),c=null,s.appendExecOut("Refresh: reloading Singles + Projects to reflect new membership…"),window.dispatchEvent(new CustomEvent("cgo:refreshAll")),s.appendExecOut("Tip: If ChatGPT’s sidebar doesn’t update instantly, refresh the ChatGPT page.");return}});function y(){const d=o.getSnapshot();n.setFromCache({singleChats:d.singleChats||[],projects:d.projects||[]})}function b(){s.setActionsEnabled(!A()),y();const d=n.buildSourceChats(),j=n.buildProjects(),v=n.getTargetProject();s.renderSourceList({chats:d,selectedIds:n.selectedChatIds,isBusy:A(),onToggle:(w,T)=>{n.toggleChat(w,T),b()}}),s.renderProjectList({projects:j,targetProjectId:n.targetProjectId,isBusy:A(),onPick:w=>{n.setTargetProject(w),b()}}),s.setCounts({sourceCount:d.length,selectedCount:n.selectedChatIds.size,projectsCount:j.length,targetLabel:(v==null?void 0:v.title)||"—"}),s.setSourceStatus(d.length?"":"No source chats loaded (refresh Single/Projects first)."),s.setProjectsStatus(j.length?"":"No projects loaded (refresh Projects first).")}function E(d){const j=n.buildSourceChats();for(const v of j)n.toggleChat(v.id,d)}function C(d){const j=n.selectedChatIds;return d.filter(v=>j.has(v.id))}function p(){s.writeExecOut(""),s.appendExecOut("Preparing move…"),s.showConfirm(!1);const d=n.getTargetProject();if(!d){s.writeExecOut("Select exactly one destination project.");return}const j=n.buildSourceChats(),v=C(j);if(!v.length){s.writeExecOut("Select at least one chat to move.");return}s.renderConfirmPreview({selectedChats:v,target:d}),s.showConfirm(!0)}function S(){e.organizeSourceEl.addEventListener("change",()=>{n.setSourceMode(e.organizeSourceEl.value),b()}),e.organizeFilterEl.addEventListener("input",()=>{n.setFilter(e.organizeFilterEl.value),b()}),e.organizeProjectFilterEl.addEventListener("input",()=>{n.setProjectFilter(e.organizeProjectFilterEl.value),b()}),e.cbOrganizeToggleAll.addEventListener("change",()=>{A()||(E(e.cbOrganizeToggleAll.checked),b())}),e.btnOrganizeClearTarget.addEventListener("click",()=>{A()||(n.clearTargetProject(),b())}),e.btnOrganizeMove.addEventListener("click",()=>{A()||p()}),e.organizeBtnCancelExecute.addEventListener("click",()=>s.showConfirm(!1)),e.organizeBtnConfirmExecute.addEventListener("click",()=>{if(!e.organizeCbConfirmEl.checked){s.writeExecOut("Blocked: tick the confirmation checkbox.");return}const j=n.getTargetProject();if(!j){s.writeExecOut("Blocked: select a destination project.");return}const w=n.buildSourceChats().filter(T=>n.selectedChatIds.has(T.id));if(!w.length){s.writeExecOut("Blocked: select at least one chat.");return}s.showConfirm(!1),f(w.map(T=>T.id),j.gizmoId).catch(T=>{s.writeExecOut(`Execute crashed: ${(T==null?void 0:T.message)||T}`),N(e,!1)})});const d=Ve({context:"organize",compact:!0});e.mountCreateProjectOrganizeEl.replaceChildren(d.el),d.el.addEventListener("cgo:createProject",j=>{const v=j;(async()=>{if(A())return;const{name:w,description:T}=v.detail;d.setBusy(!0),d.setStatus("Creating…");try{const L=await X({type:B.CREATE_PROJECT,name:w,description:T,prompt_starters:[]});if(!L){d.setStatus("Create failed (no response).");return}if(!L.ok){d.setStatus(`Create failed: ${L.error||"unknown error"}`);return}d.setStatus("Created."),d.reset(),Xe()}catch(L){d.setStatus(`Create failed: ${(L==null?void 0:L.message)||L}`)}finally{d.setBusy(!1)}})()})}return{id:"organize",refresh(){b()},mount(){b(),r=o.subscribe(()=>b())},unmount(){},bind:S,dispose(){g(),r==null||r(),r=null}}}function ze(e){return(e||"").toLowerCase().trim()}function le(e){if(!e)return 0;const t=Date.parse(e);return Number.isFinite(t)?t:0}function Ts(e){const[t,o,n]=e.split("-").map(s=>Number(s));return!t||!o||!n?0:new Date(t,o-1,n,0,0,0,0).getTime()}function zs(e){const[t,o,n]=e.split("-").map(s=>Number(s));return!t||!o||!n?0:new Date(t,o-1,n,23,59,59,999).getTime()}function Ke(e){const t=[e.title,e.snippet,e.id,e.gizmoId];return ze(t.filter(Boolean).join(` 
`))}function Ls(e,t){const o=[e.title,e.gizmoId,Ke(t)];return ze(o.filter(Boolean).join(` 
`))}function ke(e,t){const o=e.isArchived===!0;return t==="include"?!0:t==="exclude"?!o:o}function de(e,t,o){if(t==="any")return!0;if(!e)return!1;const n=t==="24h"?24*60*60*1e3:t==="7d"?7*24*60*60*1e3:t==="30d"?30*24*60*60*1e3:365*24*60*60*1e3;return e>=o-n}function ue(e,t,o){if(!t&&!o)return!0;if(!e)return!1;if(t){const n=Ts(t);if(n&&e<n)return!1}if(o){const n=zs(o);if(n&&e>n)return!1}return!0}function ws(e){const t=Math.max(20,Math.min(300,5e3));let o=null,n="",s={scope:"all",archived:"include",updatedWithin:"any",updatedAfter:"",updatedBefore:"",createdWithin:"any",createdAfter:"",createdBefore:""};function r(h){o=h}function c(h){n=h}function a(h){s={...s,...h}}function u(){return{...s}}function P(){return o?o.singleChats.length>0||o.projects.length>0:!1}function l(){if(!o)return{query:n,totalMatches:0,items:[]};const h=ze(n),i=Date.now(),f=[];let g=0;const y=C=>{g++,f.length<t&&f.push(C)},b=s.scope==="all"||s.scope==="single",E=s.scope==="all"||s.scope==="project";if(b)for(const C of o.singleChats){if(!ke(C,s.archived))continue;const p=le(C.updateTime);if(!de(p,s.updatedWithin,i)||!ue(p,s.updatedAfter||void 0,s.updatedBefore||void 0))continue;const S=le(C.createTime);de(S,s.createdWithin,i)&&ue(S,s.createdAfter||void 0,s.createdBefore||void 0)&&(!h||Ke(C).includes(h))&&y({kind:"single",chat:C})}if(E)for(const C of o.projects)for(const p of C.conversations||[]){if(!ke(p,s.archived))continue;const S=le(p.updateTime);if(!de(S,s.updatedWithin,i)||!ue(S,s.updatedAfter||void 0,s.updatedBefore||void 0))continue;const d=le(p.createTime);if(!de(d,s.createdWithin,i)||!ue(d,s.createdAfter||void 0,s.createdBefore||void 0))continue;const j=Ls(C,p);(!h||j.includes(h))&&y({kind:"project",project:C,chat:p})}return{query:n,totalMatches:g,items:f}}return{setSnapshot:r,setQuery:c,setFilters:a,getFilters:u,get query(){return n},hasData:P,search:l,maxResults:t}}function Z(e){return e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;")}function Be(e){if(!e)return"";const t=String(e).match(/^(\d{4}-\d{2}-\d{2})/);return t?t[1]:""}function Os(e){const t=[];e.isArchived===!0&&t.push('<span class="badge badge--arch" title="Archived">A</span>');const o=Be(e.updateTime);o&&t.push(`<span class="badge badge--date" title="Updated">u:${Z(o)}</span>`);const n=Be(e.createTime);return n&&t.push(`<span class="badge badge--date" title="Created">c:${Z(n)}</span>`),t.length?`<span class="searchBadges">${t.join("")}</span>`:""}function ks(e){function t(r){e.searchStatusEl.textContent=r}function o(r){const{loaded:c,limits:a}=r;e.searchLoadedSinglesEl.textContent=String(c.singleChats),e.searchLoadedProjectsEl.textContent=String(c.projects),e.searchLoadedProjectChatsEl.textContent=String(c.projectChats);const u=[];typeof a.singleLimit=="number"&&u.push(`single limit ${a.singleLimit}`),typeof a.projectsLimit=="number"&&u.push(`projects limit ${a.projectsLimit}`),typeof a.projectsChatsLimit=="number"&&u.push(`chats/project limit ${a.projectsChatsLimit}`),e.searchInfoLimitsEl.textContent=u.length?`Limits: ${u.join(" · ")}`:""}function n(r){const c=[];for(const a of r){const u=Z(a.chat.title||"(untitled)"),P=Z(a.chat.href),l=a.chat.snippet?`<div class="searchSnippet">${Z(a.chat.snippet)}</div>`:"",h=Os(a.chat);if(a.kind==="single")c.push(`<li class="item searchItem"><div class="searchLine"><a class="searchTitle" href="${P}" target="_blank" rel="noopener noreferrer">${u}</a>`+h+"</div>"+l+"</li>");else{const i=Z(a.project.title||a.project.gizmoId);c.push(`<li class="item searchItem"><div class="searchLine"><a class="searchTitle" href="${P}" target="_blank" rel="noopener noreferrer">${u}</a><span class="searchProject">(${i})</span>`+h+"</div>"+l+"</li>")}}e.searchResultsEl.innerHTML=c.join("")}function s(r){if(o(r),!r.loaded.totalChats){t("No data loaded yet. Use the Info section to list Single/Projects, then search here."),e.searchResultsEl.innerHTML="";return}if(!r.query.trim()){t("Showing all loaded chats (limited). Type to filter."),n(r.results);return}t(`Results: ${r.results.length}`),n(r.results)}return{setStatus:t,render:s,renderResults:n}}function Bs(e,t,o){const n=ws(),s=ks(e);function r(){const h=o.getSnapshot();n.setSnapshot(h);const i=n.search();e.searchResultsCountEl.textContent=String(i.totalMatches),s.render({loaded:h.counts,limits:{singleLimit:h.meta.singleLimit,projectsLimit:h.meta.projectsLimit,projectsChatsLimit:h.meta.projectsChatsLimit},query:i.query,results:i.items})}const c=o.subscribe(()=>{r()});function a(){const h=e.searchScopeEl.value,i=h==="projects"?"project":h;n.setFilters({scope:i,archived:e.searchArchivedEl.value,updatedWithin:e.searchUpdatedWithinEl.value,updatedAfter:e.searchUpdatedAfterEl.value||"",updatedBefore:e.searchUpdatedBeforeEl.value||"",createdWithin:e.searchCreatedWithinEl.value,createdAfter:e.searchCreatedAfterEl.value||"",createdBefore:e.searchCreatedBeforeEl.value||""})}function u(){a(),n.setQuery(e.searchQueryEl.value||""),r()}function P(){e.searchScopeEl.value="all",e.searchArchivedEl.value="include",e.searchUpdatedWithinEl.value="any",e.searchUpdatedAfterEl.value="",e.searchUpdatedBeforeEl.value="",e.searchCreatedWithinEl.value="any",e.searchCreatedAfterEl.value="",e.searchCreatedBeforeEl.value=""}function l(){e.searchQueryEl.addEventListener("input",()=>u()),e.btnSearchClear.addEventListener("click",()=>{e.searchQueryEl.value="",e.searchQueryEl.focus(),u()}),e.searchScopeEl.addEventListener("change",()=>u()),e.searchArchivedEl.addEventListener("change",()=>u()),e.searchUpdatedWithinEl.addEventListener("change",()=>u()),e.searchUpdatedAfterEl.addEventListener("change",()=>u()),e.searchUpdatedBeforeEl.addEventListener("change",()=>u()),e.searchCreatedWithinEl.addEventListener("change",()=>u()),e.searchCreatedAfterEl.addEventListener("change",()=>u()),e.searchCreatedBeforeEl.addEventListener("change",()=>u()),e.btnSearchResetFilters.addEventListener("click",()=>{P(),u()})}return{id:"search",mount(){const h=o.getSnapshot();if(!((h.counts.singleChats||0)>0||(h.counts.projects||0)>0||(h.counts.projectChats||0)>0)){s.setStatus("No data loaded. Use Scope → Refresh."),e.searchResultsCountEl.textContent="0";return}u()},unmount(){},bind:l,dispose(){c()}}}function Ds(){let e=[],t=0;function o(n){e=n.items,t=n.total}return{get items(){return e},get total(){return t},set:o}}function As(e){try{return new Date(e).toLocaleString()}catch{return String(e)}}function De(e,t){const o=[];o.push(`Total entries: ${t.total}`),o.push("");for(const n of t.items){const s=typeof n.ok=="boolean"?n.ok?"ok":"fail":"",r=[];typeof n.status=="number"&&r.push(`status=${n.status}`),s&&r.push(s);const c=[n.scope,n.kind].filter(Boolean).join("/");o.push(`[${As(n.ts)}] ${c}${r.length?` (${r.join(", ")})`:""}`),o.push(`  ${n.message}`),n.error&&o.push(`  error: ${n.error}`),o.push("")}e.textContent=o.join(`
`),e.scrollTop=0}function _s(e){function t(c){e.logsStatusEl.textContent=c}function o(c){e.debugStatusEl.textContent=c}function n(c){e.logsCbDebugEl.checked=c}function s(c){De(e.logsOutEl,{total:c.total,items:c.items.map(a=>({ts:a.ts,message:a.message,scope:a.scope,kind:a.kind,ok:a.ok,status:a.status,error:a.error,meta:a.meta}))})}function r(c){De(e.debugOutEl,{total:c.total,items:c.items.map(a=>({ts:a.ts,message:a.message,scope:a.scope,kind:a.kind,ok:a.ok,status:a.status,error:a.error,meta:a.meta}))})}return{setAuditStatus:t,setDebugStatus:o,setDebugChecked:n,renderAudit:s,renderDebug:r}}const he="cgo.debugTrace",Ie="cgo.debugTrace.enabled";function Ae(e,t,o){return Math.max(t,Math.min(o,Math.floor(e)))}async function Ye(){const e=await ee(he),t=e==null?void 0:e[he];return Array.isArray(t)?t:[]}async function $s(){const e=await ee(Ie);return!!(e!=null&&e[Ie])}async function Rs(e){await re({[Ie]:!!e}),e||await xe(he)}async function Ms(){await xe(he)}async function Ns(e){const t=Ae((e==null?void 0:e.limit)??200,1,5e4),o=Ae((e==null?void 0:e.offset)??0,0,1e6),n=await Ye(),s=n.length,c=n.slice().reverse().slice(o,o+t);return{total:s,items:c}}async function Us(e){const t=await Ye();return JSON.stringify(t,null,2)}const je="cgo_dev_config",ve={traceScope:!1,stopAfterOutOfScopeProjects:3};async function qe(){const t=(await ee(je))[je];return{traceScope:(t==null?void 0:t.traceScope)??ve.traceScope,stopAfterOutOfScopeProjects:typeof(t==null?void 0:t.stopAfterOutOfScopeProjects)=="number"&&t.stopAfterOutOfScopeProjects>=0?Math.floor(t.stopAfterOutOfScopeProjects):ve.stopAfterOutOfScopeProjects}}async function Ee(e){await re({[je]:e})}async function _e(e){if(!e.cfgTraceScopeEl||!e.cfgStopAfterOutOfScopeEl)return;const t=await qe();e.cfgTraceScopeEl.checked=t.traceScope,e.cfgStopAfterOutOfScopeEl.value=String(t.stopAfterOutOfScopeProjects)}function Ce(e,t){e.cfgStatusEl&&(e.cfgStatusEl.textContent=t,window.setTimeout(()=>{e.cfgStatusEl&&e.cfgStatusEl.textContent===t&&(e.cfgStatusEl.textContent="")},1200))}async function $e(e){const t=await qe();if(!e.cfgTraceScopeEl||!e.cfgStopAfterOutOfScopeEl)return t;const o=Math.max(0,Math.floor(Number(e.cfgStopAfterOutOfScopeEl.value||"0")));return{traceScope:!!e.cfgTraceScopeEl.checked,stopAfterOutOfScopeProjects:Number.isFinite(o)?o:t.stopAfterOutOfScopeProjects}}function Hs(e,t){const o=Ds(),n=_s(e);async function s(){n.setAuditStatus("Loading…"),N(e,!0);try{const g=q(e.logsLimitEl.value,10,5e3,200),y=await fs({limit:g,reverse:!0});o.set(y),n.renderAudit({items:o.items,total:o.total}),n.setAuditStatus(`Showing ${o.items.length} (newest first)`)}catch(g){n.setAuditStatus(`Failed: ${(g==null?void 0:g.message)||g}`)}finally{N(e,!1)}}async function r(){n.setDebugStatus("Loading…"),N(e,!0);try{const g=q(e.debugLimitEl.value,10,5e3,200),y=await Ns({limit:g,reverse:!0});n.renderDebug(y),n.setDebugStatus(`Showing ${y.items.length} (newest first)`)}catch(g){n.setDebugStatus(`Failed: ${(g==null?void 0:g.message)||g}`)}finally{N(e,!1)}}async function c(){const g=await $s();n.setDebugChecked(g)}async function a(g){if(await Rs(g),n.setDebugChecked(g),!g){n.setDebugStatus("Debug OFF. Traces wiped."),e.debugOutEl.textContent="";return}n.setDebugStatus("Debug ON."),await r()}async function u(){const g=q(e.logsTrimKeepEl.value,0,5e4,2e3);n.setAuditStatus("Trimming…"),N(e,!0);try{const y=await ps({keepLast:g});await s(),n.setAuditStatus(`Trimmed. Remaining: ${y.total}`)}catch(y){n.setAuditStatus(`Trim failed: ${(y==null?void 0:y.message)||y}`)}finally{N(e,!1)}}async function P(){n.setAuditStatus("Clearing…"),N(e,!0);try{await hs(),await s(),n.setAuditStatus("Cleared.")}catch(g){n.setAuditStatus(`Clear failed: ${(g==null?void 0:g.message)||g}`)}finally{N(e,!1)}}async function l(){n.setAuditStatus("Exporting…");try{const g=await ms({pretty:!0}),y=new Blob([g],{type:"application/json"}),b=URL.createObjectURL(y),E=document.createElement("a");E.href=b,E.download=`chatgpt-organizer-audit-${Date.now()}.json`,E.click(),setTimeout(()=>URL.revokeObjectURL(b),1e3),n.setAuditStatus("Exported.")}catch(g){n.setAuditStatus(`Export failed: ${(g==null?void 0:g.message)||g}`)}}async function h(){n.setDebugStatus("Clearing…"),N(e,!0);try{await Ms(),await r(),n.setDebugStatus("Cleared.")}catch(g){n.setDebugStatus(`Clear failed: ${(g==null?void 0:g.message)||g}`)}finally{N(e,!1)}}async function i(){n.setDebugStatus("Exporting…");try{const g=await Us({pretty:!0}),y=new Blob([g],{type:"application/json"}),b=URL.createObjectURL(y),E=document.createElement("a");E.href=b,E.download=`chatgpt-organizer-debug-${Date.now()}.json`,E.click(),setTimeout(()=>URL.revokeObjectURL(b),1e3),n.setDebugStatus("Exported.")}catch(g){n.setDebugStatus(`Export failed: ${(g==null?void 0:g.message)||g}`)}}function f(){e.btnLogsRefresh.addEventListener("click",()=>{A()||s().catch(()=>{})}),e.btnLogsTrim.addEventListener("click",()=>{A()||u().catch(()=>{})}),e.btnLogsClear.addEventListener("click",()=>{A()||P().catch(()=>{})}),e.btnLogsExport.addEventListener("click",()=>{A()||l().catch(()=>{})}),e.logsCbDebugEl.addEventListener("change",()=>{A()||a(e.logsCbDebugEl.checked).catch(()=>{})}),e.btnDebugRefresh.addEventListener("click",()=>{A()||r().catch(()=>{})}),e.btnDebugClear.addEventListener("click",()=>{A()||h().catch(()=>{})}),e.btnDebugExport.addEventListener("click",()=>{A()||i().catch(()=>{})}),e.cfgTraceScopeEl&&e.cfgStopAfterOutOfScopeEl&&e.btnCfgResetDefaults&&(e.cfgTraceScopeEl.addEventListener("change",async()=>{const g=await $e(e);await Ee(g),Ce(e,"Saved")}),e.cfgStopAfterOutOfScopeEl.addEventListener("change",async()=>{const g=await $e(e);await Ee(g),e.cfgStopAfterOutOfScopeEl.value=String(g.stopAfterOutOfScopeProjects),Ce(e,"Saved")}),e.btnCfgResetDefaults.addEventListener("click",async()=>{await Ee(ve),await _e(e),Ce(e,"Reset")}))}return{id:"logs",bind:f,mount(){c().catch(()=>{}),s().catch(()=>{}),r().catch(()=>{}),_e(e).catch(()=>{})},unmount(){},dispose(){}}}function me(e){if(!e)return 0;const t=Date.parse(e);return Number.isFinite(t)?t:0}function Ze(e){if(!e)return"";const t=String(e).match(/^(\d{4}-\d{2}-\d{2})/);return t?t[1]:""}function Gs(e){const t=[];for(const o of e.singleChats)t.push(o);for(const o of e.projects)for(const n of o.conversations||[])t.push(n);return t}function Fs(e){let t=0;for(const o of e)o.isArchived===!0&&t++;return t}function Js(e){const t=[];return typeof e.singleLimit=="number"&&t.push(`single limit ${e.singleLimit}`),typeof e.projectsLimit=="number"&&t.push(`projects limit ${e.projectsLimit}`),typeof e.projectsChatsLimit=="number"&&t.push(`chats/project limit ${e.projectsChatsLimit}`),t.length?`Limits: ${t.join(" · ")}`:"Limits: —"}function Ws(e){const t=Number(e.singleUpdatedTs||0),o=Number(e.projectsUpdatedTs||0);return Math.max(t,o)}function Vs(e){const t={sameDay:0,d1_2:0,d3_7:0,d8_30:0,d31p:0,unknown:0},o=24*60*60*1e3;for(const n of e){const s=me(n.createTime),r=me(n.updateTime);if(!s||!r||r<s){t.unknown++;continue}const c=Math.floor((r-s)/o);c<=0?t.sameDay++:c<=2?t.d1_2++:c<=7?t.d3_7++:c<=30?t.d8_30++:t.d31p++}return t}function Xs(e,t=12){const o=new Map;for(const s of e){const r=Ze(s.createTime);r&&o.set(r,(o.get(r)||0)+1)}const n=Array.from(o.entries()).map(([s,r])=>({day:s,count:r}));return n.sort((s,r)=>r.count-s.count||(s.day<r.day?1:-1)),n.slice(0,t)}function Ks(e){const t=e.length;let o=0;const n={empty:0,small:0,medium:0,large:0,huge:0},s=e.map(r=>({title:r.title||r.gizmoId,gizmoId:r.gizmoId,chats:(r.conversations||[]).length})).sort((r,c)=>c.chats-r.chats).slice(0,10);for(const r of e){const c=(r.conversations||[]).length;c===0?(o++,n.empty++):c<=5?n.small++:c<=20?n.medium++:c<=100?n.large++:n.huge++}return{projectCount:t,emptyProjects:o,sizeBuckets:n,topProjects:s}}function Ys(e){const t=new Map;for(const n of e){const s=Ze(n.createTime);s&&t.set(s,(t.get(s)||0)+1)}const o=Array.from(t.entries()).map(([n,s])=>({day:n,count:s}));return o.sort((n,s)=>n.day<s.day?-1:n.day>s.day?1:0),o}function qs(){let e={deletedChats:0,deletedProjects:0};function t(n){e={deletedChats:Math.max(0,Number(n.deletedChats||0)),deletedProjects:Math.max(0,Number(n.deletedProjects||0))}}function o(n){const s=Gs(n),r={singleChats:n.counts.singleChats,projects:n.counts.projects,projectChats:n.counts.projectChats,totalChats:n.counts.totalChats,archivedChats:Fs(s),avgChatsPerProject:n.counts.projects>0?n.counts.projectChats/Math.max(1,n.counts.projects):0,lastCacheUpdateTs:Ws(n.meta),limitsHint:Js(n.meta)};let c=0,a=0;for(const l of s)me(l.createTime)&&c++,me(l.updateTime)&&a++;const u={createdKnown:c,updatedKnown:a,createdPerDayTop:Xs(s,12),createdPerDay:Ys(s),lifetime:Vs(s)},P=Ks(n.projects);return{totals:r,activity:u,projects:P,deletes:e}}return{setDeletes:t,compute:o}}function Zs(e){if(!e)return"—";const t=new Date(e),o=t.getFullYear(),n=String(t.getMonth()+1).padStart(2,"0"),s=String(t.getDate()).padStart(2,"0"),r=String(t.getHours()).padStart(2,"0"),c=String(t.getMinutes()).padStart(2,"0");return`${o}-${n}-${s} ${r}:${c}`}function Qs(e,t=0){return Number.isFinite(e)?t?e.toFixed(t):String(Math.round(e)):"0"}function ie(e){return String(e||"").replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;")}function Se(e,t,o){const n=Math.max(1,...t.map(c=>c.value)),s=(o==null?void 0:o.valueLabel)??(c=>String(c)),r=[];r.push('<div class="statsBars">');for(const c of t){const a=Math.max(0,Math.min(100,c.value/n*100)),u=c.hint?ie(c.hint):`${ie(c.label)}: ${c.value}`;r.push(`<div class="statsBarItem" title="${u}"><div class="statsBarLabel">${ie(c.label)}</div><div class="statsBarTrack"><div class="statsBarFill" style="width:${a.toFixed(1)}%"></div></div><div class="statsBarValue">${ie(s(c.value))}</div></div>`)}r.push("</div>"),e.innerHTML=r.join("")}function eo(e,t,o){const n=new Map;for(const x of t){const O=String(x.day||"").slice(0,10);/^\d{4}-\d{2}-\d{2}$/.test(O)&&n.set(O,Number(x.count||0))}if(n.size===0){e.innerHTML='<div class="statsHeatmapWrap"><div class="statsHeatmapHeader"><div class="statsHeatmapTitle">Activity</div><div class="statsHeatmapHint">No created timestamps in the retrieved data.</div></div></div>';return}function s(x){const[O,$,I]=x.split("-").map(z=>Number(z));return new Date(O,($||1)-1,I||1)}function r(x){return`${x.getFullYear()}-${String(x.getMonth()+1).padStart(2,"0")}-${String(x.getDate()).padStart(2,"0")}`}const c=Array.from(n.keys()).sort(),a=c[0],u=c[c.length-1],P=s(a),l=s(u),h=(P.getDay()+6)%7,i=new Date(P);i.setDate(P.getDate()-h);const f=(l.getDay()+6)%7,g=new Date(l);g.setDate(l.getDate()+(6-f));const y=24*60*60*1e3,b=Math.round((g.getTime()-i.getTime())/y)+1,E=Math.ceil(b/7),C=Math.max(8,Math.min(o==null?void 0:o.maxWeeks,260)),p=Math.min(E,C),S=E>p;let d=1;for(let x=0;x<p;x++)for(let O=0;O<7;O++){const $=new Date(i);$.setDate(i.getDate()+x*7+O);const I=r($),z=n.get(I)||0;z>d&&(d=z)}function j(x){if(x<=0)return 0;const O=x/d;return O<=.25?1:O<=.5?2:O<=.75?3:4}const v=[];let w=0;for(let x=0;x<p;x++)for(let O=0;O<7;O++){const $=new Date(i);$.setDate(i.getDate()+x*7+O);const I=r($),z=n.get(I)||0;w+=z;const D=`statsHeatCell statsHeat${j(z)}`,k=`${I} · ${z} created`;v.push(`<div class="${D}" title="${ie(k)}"></div>`)}const T=new Date(i);T.setDate(i.getDate()+p*7-1);const L=r(i),m=r(T);e.innerHTML=`<div class="statsHeatmapWrap"><div class="statsHeatmapHeader"><div class="statsHeatmapTitle">From ${L} to ${m} · ${p} week(s)</div><div class="statsHeatmapHint">Total created: ${w} · Max/day: ${d}`+(S?` · Showing first ${p}/${E} weeks (increase maxWeeks or scroll)`:"")+`</div></div><div class="statsHeatmapGrid">${v.join("")}</div></div>`}function to(e){function t(n){e.statsStatusEl.textContent=n}function o(n){const s=n.totals;e.statsSingleChatsEl.textContent=String(s.singleChats),e.statsProjectsEl.textContent=String(s.projects),e.statsProjectChatsEl.textContent=String(s.projectChats),e.statsTotalChatsEl.textContent=String(s.totalChats),e.statsArchivedChatsEl.textContent=String(s.archivedChats),e.statsAvgChatsPerProjectEl.textContent=Qs(s.avgChatsPerProject,1),e.statsLastCacheUpdateEl.textContent=Zs(s.lastCacheUpdateTs),e.statsLimitsHintEl.textContent=s.limitsHint,e.statsDeletedChatsEl.textContent=String(n.deletes.deletedChats),e.statsDeletedProjectsEl.textContent=String(n.deletes.deletedProjects);const r=n.activity;eo(e.statsCreatedHeatmapEl,r.createdPerDay,{maxWeeks:104});const c=r.lifetime;Se(e.statsLifetimeHistEl,[{label:"0d",value:c.sameDay,hint:"Updated the same day it was created"},{label:"1–2d",value:c.d1_2},{label:"3–7d",value:c.d3_7},{label:"8–30d",value:c.d8_30},{label:"31d+",value:c.d31p},{label:"unknown",value:c.unknown,hint:"Missing createTime/updateTime (or invalid order)"}]);const a=n.projects;Se(e.statsProjectSizeHistEl,[{label:"0",value:a.sizeBuckets.empty,hint:"Empty projects"},{label:"1–5",value:a.sizeBuckets.small},{label:"6–20",value:a.sizeBuckets.medium},{label:"21–100",value:a.sizeBuckets.large},{label:"101+",value:a.sizeBuckets.huge}]),a.topProjects.length?Se(e.statsTopProjectsEl,a.topProjects.map(u=>({label:u.title,value:u.chats,hint:`${u.title} · ${u.chats} chats`})),{valueLabel:u=>String(u)}):e.statsTopProjectsEl.innerHTML='<div class="muted">No projects loaded.</div>'}return{setStatus:t,render:o}}function no(e,t,o){const n=qs(),s=to(e);let r=null,c=null;async function a(){const h=await Te();n.setDeletes({deletedChats:h.deletedChats,deletedProjects:h.deletedProjects})}async function u(h){const i=o.getSnapshot(),f=n.compute(i);s.render(f),s.setStatus(h)}function P(){const h=(i,f)=>{f==="local"&&i[pe]&&a().then(()=>u("Updated (storage)")).catch(()=>s.setStatus("Stats storage update failed"))};return as(h),()=>ls(h)}function l(){e.btnStatsRecalc.addEventListener("click",()=>{u("Recalculated").catch(()=>s.setStatus("Recalc failed"))})}return{id:"stats",async mount(){s.setStatus("Loading…"),await a().catch(()=>{}),c||(c=P()),r||(r=o.subscribe(()=>{u("Updated from cache").catch(()=>s.setStatus("Update failed"))})),await u("Ready")},unmount(){},bind:l,dispose(){r&&r(),r=null,c&&c(),c=null}}}const be="cgo.scopeUpdatedSince";function Re(e){return String(e).padStart(2,"0")}function so(e){const t=e.getFullYear(),o=Re(e.getMonth()+1),n=Re(e.getDate());return`${t}-${o}-${n}`}function oo(e,t){const o=new Date(e),n=o.getDate();return o.setMonth(o.getMonth()-t),o.getDate()!==n&&o.setDate(0),o}function Me(e){return/^\d{4}-\d{2}-\d{2}$/.test(e)}function io(e){return new Promise(t=>setTimeout(t,e))}async function Ne(e=10*60*1e3){const t=Date.now();for(;A();){if(Date.now()-t>e)return!1;await io(120)}return!0}(async()=>{const e=ts(),t=os();t.start();const o=rs(),n=bs(e,t,o),s=js(e,t,o),r=Bs(e,t,o),c=xs(e,t,o),a=Hs(e),u=no(e,t,o);n.bind(),s.bind(),c.bind(),r.bind(),a.bind(),u.bind();const P=is(e,{single:n,projects:s,organize:c,search:r,logs:a,stats:u});P.bind(),P.boot(),e.btnListSingle.hidden=!0,e.btnListProjects.hidden=!0,e.btnSearchListSingle.hidden=!0,e.btnSearchListProjects.hidden=!0;let l="";function h(){var d,j,v;const p=o.getSnapshot();return(((d=p.counts)==null?void 0:d.singleChats)??0)+(((j=p.counts)==null?void 0:j.projects)??0)+(((v=p.counts)==null?void 0:v.projectChats)??0)===0}function i(p){const S=o;typeof S.setScopeUpdatedSince=="function"&&S.setScopeUpdatedSince(p)}function f(p){h()?(e.scopeLabelEl.textContent="No data loaded — set scope & refresh",e.scopeLabelEl.classList.add("is-warn")):(e.scopeLabelEl.textContent=p?`Updated since ${p}`:"Updated since —",e.scopeLabelEl.classList.remove("is-warn")),e.scopeDialogEl.open||(e.scopeDateEl.value=p||"")}async function g(){const p=await ee([be]).catch(()=>({})),S=p==null?void 0:p[be];return typeof S=="string"&&Me(S)?S:so(oo(new Date,3))}async function y(p){await re({[be]:p}).catch(()=>null)}async function b(){A()||(n.refresh(),!await Ne())||(s.refresh(),await Ne())}function E(){if(!A()){e.scopeDateEl.value=l||"";try{e.scopeDialogEl.showModal()}catch{}}}function C(){try{e.scopeDialogEl.close()}catch{}}l=await g(),i(l),f(l),window.addEventListener("cgo:refreshAll",()=>{b().catch(()=>{})}),e.btnScopeChange.addEventListener("click",()=>{E()}),e.btnScopeRefresh.addEventListener("click",()=>{b().catch(()=>{})}),e.btnScopeCancel.addEventListener("click",()=>{e.scopeDateEl.value=l||"",C()}),e.btnScopeApply.addEventListener("click",()=>{const p=e.scopeDateEl.value||"";Me(p)&&(l=p,i(l),f(l),y(l).catch(()=>{}),C(),b().catch(()=>{}))}),e.scopeDialogEl.addEventListener("keydown",p=>{var S;p.key==="Enter"&&((S=p.target)==null?void 0:S.tagName)==="INPUT"&&(p.preventDefault(),e.btnScopeApply.click())}),o.subscribe(()=>{const p=o.getSnapshot();e.scopeLoadedSinglesEl.textContent=String(p.counts.singleChats),e.scopeLoadedProjectsEl.textContent=String(p.counts.projects),e.scopeLoadedProjectChatsEl.textContent=String(p.counts.projectChats),f(l)})})();
